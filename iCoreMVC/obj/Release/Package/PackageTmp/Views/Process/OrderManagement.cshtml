@{
    ViewBag.Title = "OrderManagement";
}


<link href="~/Content/css/plugins/blueimp/css/blueimp-gallery.min.css" rel="stylesheet">
<script src="~/Scripts/js/plugins/watermark/jquery.watermark.js"></script>
<link href="~/Content/css/plugins/fileupload/jquery.fileupload.css" rel="stylesheet" />
<link href="~/Content/css/plugins/fileupload/jquery.fileupload-ui.css" rel="stylesheet" />
<link href="~/Content/css/plugins/datetimepicker/bootstrap-datetimepicker.css" rel="stylesheet" />
<link href="~/Content/css/plugins/datetimepicker/jquery.timeentry.css" rel="stylesheet" />
<link href="~/Content/css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">


@*<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    @*
<script src="//code.jquery.com/jquery-1.10.2.js"></script>*@
@*
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>*@
@*<link rel="stylesheet" href="//jqueryui.com/jquery-wp-content/themes/jqueryui.com/style.css">*@
<script src="~/Scripts/js/plugins/datetimepicker/moment-with-locales.js"></script>
<script src="~/Scripts/js/plugins/datetimepicker/bootstrap-datetimepicker.js"></script>
<script src="~/Scripts/js/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>
<script src="~/Scripts/js/plugins/datetimepicker/jquery.plugin.js"></script>
<script src="~/Scripts/js/plugins/datetimepicker/jquery.timeentry.js"></script>
@*
<script src="~/Scripts/js/plugins/blueimp/bootstrap-image-gallery.js"></script>*@

<script src="~/Scripts/zip/jszip.js"></script>

<script src="~/Scripts/js/plugins/ladda/spin.min.js"></script>
<script src="~/Scripts/js/plugins/ladda/ladda.min.js"></script>
<script src="~/Scripts/js/plugins/ladda/ladda.jquery.min.js"></script>

<style>
    .col-width {
        width: 17%;
    }


    /*.image-checkbox {
        position: absolute;
        right: 17px;
        top: 15px;
        z-index: 16;
    }*/
    /*.image-checkbox {
        position: absolute;
        right: 133px;
        top: 2px;
        z-index: 16;
    }*/
    .image-checkbox {
        position: absolute;
        right: 220px;
        top: 2px;
        z-index: 16;
    }

    .imgcontainer {
        /*position: relative;
        width: 100px;
        height: 100px;
        float: left;
        margin-left: 10px;
        margin-bottom:20px;*/
        position: relative;
        width: 100px;
        height: 100px;
        float: left;
        margin-right: 35px;
        margin-bottom: 45px;
    }

    .fieicon:hover {
        background-color: gray;
    }

    .imgcontainer1 {
        position: relative;
        /*width: 100px;
        height: 100px;
        float: left;
        margin-left: 10px;*/
    }


    .checkbox {
        position: absolute;
        bottom: 0px;
        right: 0px;
    }

    .checkboxn {
        position: absolute;
        bottom: 0px;
        right: 0px;
    }

    .checkboxn_m {
        position: absolute;
        bottom: 0px;
        right: -15px;
    }

    /*.textphotoimg {
        position: absolute;
        bottom: 0px;
        right: 0px;
    }*/

    .textphotoimg {
        position: absolute;
        bottom: -42px;
    }


    .imgtick {
        position: absolute;
        bottom: 65px;
        right: -12px;
    }

    .imgtick_m {
        position: absolute;
        bottom: 72px;
        right: -20px;
    }

    .fan {
        font-size: medium;
        color: #f4f4f4;
    }
    /*.progress {
        height: 10px;
         margin-bottom: 0px;
    }*/
</style>
<style>
    input::-webkit-input-placeholder {
        font-size: 12px;
        line-height: 2;
    }

    textarea::-webkit-input-placeholder {
        font-size: 12px;
        line-height: 2;
    }

    select::-webkit-input-placeholder {
        font-size: 12px;
        line-height: 2;
    }

    /*data-placeholder{

    }*/
    .error {
        border: 2px solid red;
    }

    .imgBox {
        width: 200px;
        height: 200px;
        opacity: 1.0;
        filter: alpha(opacity=100);
    }

        .imgBox:hover {
            -moz-box-shadow: 0 0 10px #ccc;
            -webkit-box-shadow: 0 0 10px #ccc;
            box-shadow: 0 0 10px #ccc;
            opacity: 0.4;
            filter: alpha(opacity=40);
        }


    /*.modal {
        display: block !important;
    }*/

    /*.modal-dialog {
        overflow-y: initial !important;
    }*/

    /*.modal-body {
        height: 250px;
        overflow-y: auto;
    }*/
    div.cover {
        position: fixed;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
    }

    img.cover {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
        min-width: 50%;
        min-height: 50%;
        overflow-x: hidden;
        background-position: center;
        z-index: 10000000;
        width: 100%;
        height: 100%;
    }


    /*#loadingDiv {
        position: absolute;
        top: 150px;
        right: -475px;
        width: 100%;
        height: 100%;
        background-repeat: no-repeat;
        background-position: center;
        z-index: 10000000;
        opacity: 0.4;
    }*/
</style>
@*<div id="loadingDiv" style="display: block">
    <center><img id="myImage" src="~/Content/Image/loading_spinner.gif"></center>

</div>*@

<form method="get" class="form-horizontal" novalidate>

    <div id="CPD_Master" class="divbody">

        <div class="col-sm-12" style="padding-right:10px">
            <div class="ibox float-e-margins">

                <div class="ibox-title">
                    <h5>&nbsp;</h5> <span class="label ">Order Info</span>


                    <div class="ibox-tools">
                        <strong><b><font color="red">(Note: Please ensure click save before leaving this page)</font></b></strong>
                        <a class="collapse-link" title="Minimize">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <strong>
                            <a href="#">
                                <i class="fa fa-save" id="btnSave" onclick="SaveData()" title="Save/Update Order"></i>
                            </a>
                            <a href="#" name="listcheck">
                                @*Add name property for check this form load from dashboard list if its from dash board controll hide if name is 'listcheck'*@
                                <i class="fa fa-file-o" id="btnNew" onclick="parent.document.getElementById('framecontent').src = '../process/ordermanagement'" title="New Order"></i>
                            </a>
                        </strong>

                        <a href="#" title="List Order" name="listcheck">
                            @*Add name property for check this form load from dashboard list if its from dash board controll hide if name is 'listcheck'*@
                            <i class="fa fa-list" id="btnOrderList" onclick="loadframesrc()"></i>
                        </a>
                    </div>
                </div>

                <div class="ibox-content" style="padding-top:10px">
                    <div class="col-sm-12 hidden" id="divOrderdet">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-5 control-label">Order No:</label>
                                <label class="col-sm-7 control-label" style=" text-align: -webkit-left;color:#337ab7" id="tLblOrderNo">&nbsp;</label>

                            </div>
                        </div>
                        <div class="col-sm-9">
                            <div class="form-group">
                                <label class="col-sm-1 control-label">Address:</label>
                                <label class="col-sm-11 control-label" style=" text-align: -webkit-left; text-align:justify; color:#337ab7" id="tLblOrderAddress">&nbsp;</label>
                            </div>
                        </div>
                    </div>
                    <div class="tabs-container">
                        <ul class="nav nav-tabs nav-tabs-justified" style="padding-left:0%;">

                            <li class="active">
                                <a href="#hometab" data-toggle="tab" id="1_gen" onclick="settabid(this)">
                                    <i style="color:#337ab7" class="fa fa-list-alt"></i>General
                                </a>
                            </li>
                            <li class="">
                                <a href="#moretab" data-toggle="tab" id="2_fee" onclick="settabid(this)">
                                    <i style="color:#337ab7" class="fa fa-credit-card"></i>Fee Info
                                </a>
                            </li>
                            <li class="">
                                <a href="#phototab" data-toggle="tab" id="3_Photo" onclick="settabid(this)">
                                    <i style="color:#337ab7" class="fa fa-file-image-o"></i>Photo Upload
                                </a>
                            </li>
                            <li class="">
                                <a href="#filetab" data-toggle="tab" id="4_file" onclick="settabid(this)">
                                    <i style="color:#337ab7" class="fa fa-file-archive-o"></i>File Upload
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="hometab" style="padding-top:15px">
                                <div class="col-sm-6">

                                    <div class="form-group hidden">
                                        <label class="col-sm-3 control-label">Order No:</label>
                                        <div class="col-sm-9"><input type="text" readonly="readonly" id="txtorderno" placeholder="Auto generate order no" required="" class="form-control"></div>
                                    </div>
                                    <div class=" form-group hide" id="divDdlClient">
                                        <label class="col-sm-3 control-label">Sub Client <font color="red">*</font> :</label>
                                        <div class="col-sm-9">
                                            <select style="width:100%" onchange="" class="select2_demo_3 form-control" id="ddlSubClient" data-placeholder="Choose SubClient..">
                                                @*
                                                <option></option>*@
                                                @*
                                                <option value="1">Interior</option>
                                                <option value="2">Exterior</option>*@

                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Address<font color="red">*</font> :</label>
                                        <div class="col-sm-9">
                                            <input type="text" id="txtsubaddress" placeholder="Enter full address here.." class="form-control">
                                            <span class="help-block m-b-none"><i><font color="blue"><b>Address Format:</b> street_no  street_name,City,State &nbsp; ZIpcode</font></i></span>
                                        </div>
                                    </div>

                                    <div class="form-group" style="display:none">
                                        <label class="col-sm-3 control-label">County:</label>
                                        <div class="col-sm-9">
                                            <select style="width:100%" class="select2_demo_3 form-control" id="ddlcounty" data-placeholder="Choose a county...">
                                                <option></option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">State:</label>
                                        <div class="col-sm-9">
                                            <select style="width:100%" class="select2_demo_3 form-control" id="ddlstate" data-placeholder="Choose a state...">
                                                <option></option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">City:</label>
                                        <div class="col-sm-9">
                                            <select style="width:100%" class="select2_demo_3 form-control" id="ddlcity" data-placeholder="Choose a city...">
                                                <option></option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Order No<font color="red">*</font> :</label>
                                        <div class="col-sm-4">
                                            <input type="text" id="txtorderportalno" placeholder="Enter order no here.." class="form-control">
                                        </div>
                                        <label class="col-sm-2 control-label">ZipCode<font color="red">*</font> :</label>
                                        <div class="col-sm-3">
                                            <input type="text" onkeypress="return isNumber(event);" onpaste="return false" id="txtzipcode" placeholder="Enter zip code .." class="form-control" maxlength="5">
                                        </div>
                                    </div>
                                    <div class=" form-group">
                                        <label class="col-sm-3 control-label">Order Type <font color="red">*</font> :</label>
                                        <div class="col-sm-9">
                                            <select style="width:100%" onchange="BindClientFee(this)" class="select2_demo_3 form-control" id="ddlorderType" data-placeholder="Choose Order Type...">
                                                <option></option>
                                                @*
                                                <option value="1">Interior</option>
                                                <option value="2">Exterior</option>*@

                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group ">
                                        <label class="col-sm-3 control-label">Order Due:</label>
                                        <div class="col-sm-5">
                                            <div class="input-group date txtdob">
                                                <span class="input-group-addon" id="divtxtdob"><i class="fa fa-calendar"></i></span>
                                                <input type="text" id="txtdob" class="form-control" value="" readonly="readonly" style="background-color:white">
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class='input-group datetime' id='datetimepicker1'>
                                                <span class="input-group-addon">
                                                    <span class="glyphicon glyphicon-time"></span>
                                                </span>
                                                <input type='text' id="txtdobtime" class="form-control time" />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-sm-6" style="padding-right:10px">

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Remarks:</label>
                                        <div class="col-sm-9"><textarea id="txtremarks" placeholder="Enter remarks here.." class="form-control"></textarea></div>
                                    </div>

                                    <div id="divpht" class="hidden">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notes To photographer:</label>
                                            <div class="col-sm-9"><textarea id="txtnotepg" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notes From photographer:</label>
                                            <div class="col-sm-9"><textarea id="txtnotefpg" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>
                                    </div>
                                    <div id="divde" class="hidden">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notes To data entry:</label>
                                            <div class="col-sm-9"><textarea id="txtnotede" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notes From data entry:</label>
                                            <div class="col-sm-9"><textarea id="txtnotefde" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>
                                    </div>
                                    <div id="divqa" class="hidden">
                                        <div class="form-group ">
                                            <label class="col-sm-3 control-label">Notes for QA:</label>
                                            <div class="col-sm-9"><textarea id="txtnoteqa" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Notes From QA:</label>
                                            <div class="col-sm-9"><textarea id="txtnotefqa" placeholder="Enter notes here.." class="form-control"></textarea></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="moretab">
                                <div style="padding-top:10px; ">
                                    <div class="col-sm-12" style="background-color:#ccc;padding-top:10px; padding-bottom:10px">
                                        @*<div class="col-sm-1"></div>*@
                                        <div class="col-sm-4">
                                            <div class="form-group" style="margin-bottom: 0px;">
                                                <label class="col-sm-3 control-label">Portal <font color="red">*</font>:</label>
                                                <div class="col-sm-9">
                                                    <select style="width:100%" style="width:100%" class="select2_demo_3 form-control" id="ddlportal" onchange="BindOrderValue(this)" data-placeholder="Choose a portal...">
                                                        <option></option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group" style="margin-bottom: 0px;">
                                                <label class="col-sm-3 control-label">Status:</label>
                                                <div class="col-sm-9">
                                                    <select style="width:100%" class="select2_demo_3 form-control" id="ddlstatus" data-placeholder="Choose a Status...">
                                                        @*
                                                        <option></option>*@
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-5">
                                            <div class="form-group" id="data_1" style="margin-bottom: 0px;">
                                                <label class="col-sm-3 control-label">Photo Due:</label>
                                                <div class="col-sm-5">
                                                    <div class="input-group date txtphtduedate">
                                                        <span class="input-group-addon" id="divtxtphtduedate"><i class="fa fa-calendar"></i></span>
                                                        <input type="text" id="txtphtduedate" class="form-control" value="" readonly="readonly" style="background-color:white">
                                                    </div>

                                                </div>
                                                <div class="col-sm-4">
                                                    <div class='input-group datetime'>
                                                        <span class="input-group-addon">
                                                            <span class="glyphicon glyphicon-time"></span>
                                                        </span>
                                                        <input type='text' id="txtphtoduetime" class="form-control time" />
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        @*<div class="col-sm-1"></div>*@
                                    </div>
                                    </br>
                                    </br></br>
                                    </br>
                                    <div class="col-sm-12">
                                        <div class="col-sm-1"></div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Photographer <font color="red">*</font>:</label>
                                                <div class="col-sm-9">
                                                    <select style="width:100%" style="width:100%" class="select2_demo_3 form-control" id="ddlpht" data-placeholder="Choose a Photographer...">
                                                        <option></option>

                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <label class="col-sm-6 control-label">Photographer Fee<font color="red"> *</font>:</label>
                                                <div class="col-sm-6">
                                                    <div class="input-group">
                                                        <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                                        <input type="number" id="txtphtfee" class="form-control" min="0" oninput="validity.valid||(value='');">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-1"></div>
                                    </div>
                                    <div id="Rol_DataEntryQA">

                                        <div class="col-sm-12">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-3 control-label">Data Entry<font color="red"> *</font>:</label>
                                                    <div class="col-sm-9">
                                                        <select style="width:100%;" disabled="disabled" class="select2_demo_3 form-control" id="ddldataentry" data-placeholder="Choose a data entry...">
                                                            <option></option>
                                                            @*
                                                            <option value="1">ECESIS</option>*@

                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="form-group">
                                                    <label class="col-sm-6 control-label">Data Entry Fee<font color="red"> *</font>:</label>
                                                    <div class="col-sm-6">
                                                        <div class="input-group">
                                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                                            <input type="number" id="txtdefee" class="form-control" min="0" oninput="validity.valid||(value='');">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-1"></div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-3 control-label">Quality Analysis:</label>
                                                    <div class="col-sm-9">
                                                        <select style="width:100%" disabled="disabled" class="select2_demo_3 form-control" id="ddlqa" data-placeholder="Quality Analysis...">

                                                            <option></option>
                                                            @*
                                                            <option value="1">ECESIS</option>*@
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="form-group">
                                                    <label class="col-sm-6 control-label">Quality Analysis Fee:</label>
                                                    <div class="col-sm-6">
                                                        <div class="input-group">
                                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                                            <input type="number" id="txtqafee" class="form-control" min="0" oninput="validity.valid||(value='');">
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>


                                            <div class="col-sm-1"></div>
                                        </div>

                                    </div>
                                    <div id="divOrdervalue">
                                        <div class="col-sm-12">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-6">
                                                @*<div class="form-group">
                                                    <label class="col-sm-3 control-label">Quality Analysis:</label>
                                                    <div class="col-sm-9">
                                                        <select style="width:100%" disabled="disabled" class="select2_demo_3 form-control" id="ddlqa" data-placeholder="Quality Analysis...">

                                                            <option></option>
                                                        </select>
                                                    </div>
                                                </div>*@
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="form-group">
                                                    <label class="col-sm-6 control-label">Order Value<font color="red"> *</font>:</label>
                                                    <div class="col-sm-6">
                                                        <div class="input-group">
                                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                                            <input type="number" id="txtordervalue" class="form-control" min="0" value="0" oninput="validity.valid||(value='');">
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="col-sm-1"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="phototab">
                                @*<div id="box">

                                </div>*@
                                <div class="col-sm-12">
                                    <div class="ibox float-e-margins">
                                        @*<div class="ibox-content">
                                            *@


                                            @*<img id="imgwa" src="~/Content/Image/picture-add-icon.png" />*@
                                            <div class="col-sm-12">
                                                <div style="vertical-align:middle;padding-top:10px">
                                                    <img src="~/Content/Image/picture-add-icon.png" style="width:25px;height:25px" />&nbsp;<strong><b>Photos &nbsp;<font color="red">[Mandatory]</font> </b></strong>&nbsp;&nbsp;&nbsp;
                                                    @*<input accept="image/*" class="col-sm-3 btn btn-primary start" type="file" id="PhotoUpload" multiple style="margin-right: 15px" />*@
                                                    <span class="btn btn-success fileinput-button btnPhotoUp">

                                                        <i class="glyphicon glyphicon-plus" title="Add Photos" data-toggle="tooltip" data-placement="bottom"></i>
                                                        @*<img src="~/Content/Image/picture-add-icon.png" />*@
                                                        <span id="imgcount">@*Add Photos*@</span>
                                                        <input type="file" name="files[]" accept="image/*" id="PhotoUpload" multiple maxlength="7" max="7" title="Add Photos">
                                                    </span>
                                                    <button type="button" class="btn btn-primary start" id="Upload1" onclick="UploadPhoto()">
                                                        <i class="fa fan fa-upload" title="Start upload"></i>
                                                        @*<span>Start upload</span>*@
                                                    </button>
                                                    @*display:none"*@


                                                    @*<a href="#" id="Upload1" onclick="UploadPhoto()" class="btn btn-primary start" style="margin-right: 15px"><i class="fa fan fa-upload"></i></a>*@

                                                    @*<a href="#" onclick="removeimage()" class="btn btn-primary start pull-right" style="margin-left: 15px;"><i class="fa fan fa-trash-o"></i></a>*@
                                                    <button type="button" onclick="removeimage()" class="btn btn-danger delete pull-right btndeleteimg" style="margin-left: 5px;">
                                                        <i class="glyphicon glyphicon-trash" title="Delete Selected"></i>

                                                    </button>
                                                    <button onclick="downloadimage_man()" type="button" class="btn btn-info pull-right" style="margin-left: 5px;">
                                                        <i class="fa fan fa-download" title="Download Selected"></i>
                                                    </button>

                                                    <div class="pull-right col-sm-2 hidden" id="txtStampDate">

                                                        <div class="input-group date">
                                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                            <input type="text" id="txtstamdt" class="form-control" readonly="readonly" style="background-color:white; width:100px">
                                                        </div>

                                                    </div>
                                                    <div class="pull-right">
                                                        <label class="btn"> <input type="checkbox" id="chkStamp" value=""><i id="stamptext">Date Stamping</i></label>
                                                    </div>

                                                    @*<label class="btn  start pull-right"> <input type="checkbox" id="checkAll_opt" value=""> <i>Select All [Optional]</i></label>*@
                                                    <label class="btn  start pull-right"> <input type="checkbox" id="checkAll" value=""> <i>Select All</i></label>

                                                    <div id="imgdiv">
                                                        <div class="progress progress-striped active  " style="width:100%;vertical-align:middle;margin-bottom: 0px;margin-top: 7px;">
                                                            @*<div style="width: 100%;display:none" ; aria-valuemax=" 100" aria-valuemin="0" aria-valuenow="75" role="progressbar" class="progress-bar progress-bar-success">
                                                                *@
                                                                <div id="imgprogress" style="width:0%; " aria-valuemax=" 100" aria-valuemin="0" aria-valuenow="0" role="progressbar" @*class="progress-bar progress-bar-success"*@>
                                                                    <span class="" id="spnprogressper"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="ibox-content">
                                                        <center>
                                                            <div class="" id="imageshow">
                                                                <br />
                                                                <center>No Image Found</center>
                                                            </div>
                                                        </center>
                                                    </div>

                                                    <div id="dvPreview"></div>


                                                </div>

                                                @*
                                            </div>*@
                                        </div>


                                        <div class="ibox float-e-margins">
                                            <div class="ibox-content">
                                                <div class="col-sm-12">
                                                    <div style="vertical-align:middle;padding-top:10px">
                                                        <img src="~/Content/Image/picture-add-icon.png" style="width:25px;height:25px" />&nbsp;<strong><b>Photos &nbsp;<font color="blue">[Optional]</font> </b></strong>&nbsp;&nbsp;&nbsp;

                                                        <span class="btn btn-success fileinput-button btnPhotoUp">
                                                            <i class="glyphicon glyphicon-plus" title="Add Photos" data-toggle="tooltip" data-placement="bottom"></i>
                                                            <span id="imgcount_opt">@*Add Photos*@</span>
                                                            <input type="file" name="files[]" accept="image/*" id="PhotoUpload_opt" multiple>
                                                        </span>
                                                        <button type="button" class="btn btn-primary start" id="Upload1_opt" onclick="UploadPhoto_opt()">
                                                            <i class="fa fan fa-upload" title="Start upload"></i>
                                                        </button>
                                                        <span class=" pull-right hidden" id="unupdatealert">
                                                            <img class="" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px">
                                                            <font color="#01947a">&nbsp;<b>- Unupdated photo(s);</b> Please update before leaving this page</font>
                                                        </span>
                                                        <div class="hidden">
                                                            <button type="button" onclick="removeimage_opt()" class="btn btn-danger delete pull-right btndeleteimg" style="margin-left: 5px;">
                                                                <i class="glyphicon glyphicon-trash" title="Delete Selected"></i>

                                                            </button>
                                                            <button onclick="downloadimage_opt()" type="button" class="btn btn-info pull-right" style="margin-left: 5px;">
                                                                <i class="fa fan fa-download" title="Download Selected"></i>
                                                            </button>

                                                            <div class="pull-right col-sm-2 hidden" id="txtStampDate_opt">

                                                                <div class="input-group date">
                                                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                                                    <input type="text" id="txtstamdt_opt" class="form-control" readonly="readonly" style="background-color:white; width:100px">
                                                                </div>

                                                            </div>
                                                            <div class="pull-right">
                                                                <label class="btn"> <input type="checkbox" id="chkStamp_opt" value=""><i id="stamptext_opt">Date Stamping</i></label>
                                                            </div>


                                                            <label class="btn  start pull-right"> <input type="checkbox" id="checkAll_opt" value=""> <i>Select All</i></label>

                                                        </div>
                                                        <div id="imgdiv_opt">
                                                            <div class="progress progress-striped active  " style="width:100%;vertical-align:middle;margin-bottom: 0px;margin-top: 7px;">
                                                                @*<div style="width: 100%;display:none" ; aria-valuemax=" 100" aria-valuemin="0" aria-valuenow="75" role="progressbar" class="progress-bar progress-bar-success">
                                                                    *@
                                                                    <div id="imgprogress_opt" style="width:0%; display:none" ; aria-valuemax=" 100" aria-valuemin="0" aria-valuenow="0" role="progressbar" @*class="progress-bar progress-bar-success"*@>
                                                                        <span class="" id="spnprogressper_opt"></span>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                        </div>
                                                        <div class="ibox-content">
                                                            <center>
                                                                <div class="" id="imageshow_opt">
                                                                    <br />
                                                                    <center>No Image Found</center>
                                                                </div>
                                                            </center>
                                                        </div>


                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="filetab">
                                        <div class="col-sm-12">
                                            <div class="ibox float-e-margins">
                                                @*<div class="ibox-content">
                                                    *@
                                                    <div class="col-sm-12">
                                                        <div style="vertical-align:middle;padding-top:10px">
                                                            <img src="~/Content/Image/FileIcon.png" style="width:25px;height:25px" />&nbsp;<strong><b>Files</b></strong>&nbsp;&nbsp;&nbsp;
                                                            <span class="btn btn-success fileinput-button">
                                                                <i class="glyphicon glyphicon-plus"></i>
                                                                <span id="filecount"></span>
                                                                <input type="file" name="files[]" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx" id="FileUpload" multiple>
                                                            </span>
                                                            <button type="button" class="btn btn-primary start" id="Upload2" onclick="UploadFile()" title="Add Photos">
                                                                <i class="fa fan fa-upload" title="Start upload"></i>
                                                            </button>&nbsp;
                                                            <span><strong id="notefile"></strong></span>

                                                            <button type="button" onclick="removefile()" class="btn btn-danger delete pull-right btndeletefile" style="margin-left: 5px;">
                                                                <i class="glyphicon glyphicon-trash" title="Delete Selected"></i>
                                                                @*<span>Delete</span>*@
                                                            </button>

                                                            <button onclick="downloadimage_file()" type="button" class="btn btn-info pull-right" style="margin-left: 5px;">
                                                                <i class="fa fan fa-download" title="Download Selected"></i>
                                                            </button>


                                                            <label class="btn  start pull-right"> <input type="checkbox" id="checkAllFile" value=""> <i>Select All</i>   </label>

                                                        </div>
                                                        <div class="ibox-content">
                                                            <div class="" id="fileshow">
                                                                <br />
                                                                <center>No File Found</center>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @*
                                                </div>*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <br />
                                &nbsp;&nbsp;&nbsp;<font color="blue">Asterisk(<font color="red">*</font>) Symboled fields are Mandatory...</font>

                            </div>
                            <input type="hidden" id="hdnOrderId" />
                            <input type="hidden" id="hdnPostedBy" />
                            <input type="hidden" id="hdnDataentry" />
                            <div id="MailData" style="visibility: hidden">

                            </div>
                        </div>
                        <div class="" id="loadingDiv" style="display: none">
                            <img src="~/Content/Image/loading_spinner.gif" class="cover" />
                        </div>
                    </div>
                </div>
            </div>
</form>


@*Common Variables*@
<script>
    var tabid = "1_gen";
    var usec = "";
    var uip = "";
    var ddl_m_opt_val = []; var ddl_m_opt_id = []; var ddl_m_id = [];
    var filename = [];
    var unmaildphoto = [];
    var unmaildphoto_opt = [];
    var unmaildphoto_opt_mail = [];
    var txt_opt_id = [];
    var sIsDataEntryComp = 0;
    var sIsPaid = 0;
    var sOrderType = 0;
    var sOrderStatus = 0;
    var sPhtId = 0;
    var sgExistPhtId = 0;
    var sNotesFromPht = '';
    var sNotesToPht = '';
    var sNotesFromData = '';
    var sNotesToData = '';
    var sIsPhotoUpld = 0;
    var sIsPhotoExist = 0;
    var sIsPageID = 1;
    var sPageName = 'Active List'

    //variables for catching filterdata of grid

    var gs_order_code = '';
    var gs_full_name = '';
    var gs_portal_name = '';
    var gs_order_due_date = '';
    var gs_subject_address = '';
    var gs_order_type = '';
    var gs_order_status = '';

</script>




<script>
    function enumvalue() {
        var ordid = $('#hdnOrderId').val();
        var Condition = "where enumeration_key='photo_File_name'";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectPhotoFileName");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                //$("select[name=photoddl_m]").append('<option value="' + Result[i]["value"] + '">' + ordid + '_' + Result[i]["short_display"] + '</option>');
                ddl_m_opt_id.push(Result[i]["value"]);
                ddl_m_opt_val.push(ordid + '_' + Result[i]["short_display"]);
                filename.push(Result[i]["short_display"])
            }
        }
    }

    function loadframesrc() {
        parent.$("#pagename").text("Active List");
        parent.$("#ModuleTitle").text("Dashboard");
        parent.$("#SubModTitle").text("Active List");
        parent.$('#framecontent').hide();
        parent.$('#framecontentlist').show();

        //  parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + 1 + '&back=1';
        // parent.document.getElementById('framecontent').src = '../Process/OrderList?PageId=' + 1 + '&back=1';
    }
    function isNumber(evt) {
        var iKeyCode = (evt.which) ? evt.which : evt.keyCode
        if (iKeyCode != 46 && iKeyCode > 31 && (iKeyCode < 48 || iKeyCode > 57))
            return false;

        return true;
    }
    function controlsettings() {
        var OrderId = $('#hdnOrderId').val();
        if (OrderId == "") {
            $("#2_fee").css("")
        }
    }

    function show() {
        document.getElementById("loadingDiv").style.display = "block";
        // setTimeout("hide()", 7000);  // 5 seconds
    }
    function hideload() {
        document.getElementById("loadingDiv").style.display = "none";
    }
    var chane = "";
    $(function () {
        $("#txtsubaddress").change(function () {//.blur


            //if (!isNaN($("#txtsubaddress").val())) {
            //    document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
            //    msgalert('Warning', 'Address should be character or alpha numeric..!', 2);
            //    $('#txtsubaddress').focus();
            //    return;
            //}


            var subaddress = $.trim($("#txtsubaddress").val());
            var n = subaddress.split(" ");
            var zipcode = n[n.length - 1].split("-")

            //return n[n.length - 1];

            //var z = zipcode.split(" ");
            //var zip = z[z.length - 1].split("-")

            if (!isNaN(zipcode[0])) {
                $("#txtzipcode").val(zipcode[0])
                //alert(zipcode[0]);
                //alert(zipcode);
                //trigerzip("1");
                chane = "ok";
                $("#txtzipcode").change();

            }
            else {
                msgalert('Warning', 'Zipcode is not valid in address please enter manually', 2);//sucess-1, warning-2, error-3
                $('#txtzipcode').focus();
                $("#txtzipcode").val("");
                $("#ddlstate").val("").change();
                $("#ddlcity").val("").change();
                return;
            }
        });

        //function trigerzip(s) {
        //    if (s == "1") {
        //        //$("#txtzipcode").trigger("change");
        //        $("#txtzipcode").change();
        //    }

        //}

        $("#txtzipcode").change(function () {
            if ($("#txtzipcode").val() != "") {

                var Condition = "where zip_code=" + $("#txtzipcode").val() + "";
                var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
                var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsZipCodeMaster");


                //$("#txtzipcode").val(zipcode[0])
                if (Result != "" && Result != null) {
                    $("#ddlstate").val(Result[0]["state_id"]).change();
                    $("#ddlcity").val(Result[0]["city_id"]).change();
                }
                else {
                    $('#txtzipcode').focus();

                    $("#ddlstate").val("").change();
                    $("#ddlcity").val("").change();
                    if (chane == "ok") {
                        //$("#txtzipcode").val("");
                        chane = "";
                        msgalert('Warning', 'Zipcode is not found contact vendor or Enter manually', 2);//sucess-1, warning-2, error-3
                    }
                    else {
                        msgalert('Warning', 'Zipcode is not found contact vendor or continue with same', 2);//sucess-1, warning-2, error-3
                    }

                }
            }
            else {
                $('#txtzipcode').focus();
                $("#txtzipcode").val("");
                $("#ddlstate").val("").change();
                $("#ddlcity").val("").change();
            }
        });




        $("#txtdob").change(function () {
            var date2 = $('.txtdob').datepicker('getDate');
            //date2.setDate(date2.getDate()+3)

            $(".txtphtduedate").datepicker("setEndDate", $("#txtdob").val());
            $(".txtphtduedate").datepicker("setDate", $("#txtdob").val());
            $('.txtdob').datepicker('hide');
        });

        $("#txtphtduedate").change(function () {
            $('.txtphtduedate').datepicker('hide');
        });

    });
</script>
<script>
    var suborgin = "";
    function BindSubClient() {
        var Condition = "";

        if (access_level != 2) {
            Condition = "where delete_status=0 order by ref_no asc";
            //alert(access_level);
        }
        else {
            Condition = "where client_ref_id=" + EmpId + " and delete_status=0 order by ref_no asc";
        }
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsSubClient");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlSubClient').append('<option value="' + Result[i]["ref_no"] + '">' + Result[i]["full_name"] + ' </option>');

            }
            if (Result.length > 1) {
                $('#divDdlClient').removeClass("hide");
            }
            $("select#ddlSubClient")[0].selectedIndex = 0;
            //document.getElementById("ddlSubClient").selectedIndex = 1;
            $('#ddlSubClient').trigger("change");


        }


    }
    function BindSubClientwithorder(subclientid, clientid) {
        var Condition = "";
        $('#ddlSubClient').empty().change();
        $('#ddlSubClient').append('<option></option>');
        //if (access_level != 2) {
        //    Condition = "where delete_status=0 order by ref_no asc";
        //    //alert(access_level);
        //}
        //else {
        Condition = "where client_ref_id=" + clientid + " and delete_status=0 order by ref_no asc";
        //}
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsSubClient");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlSubClient').append('<option value="' + Result[i]["ref_no"] + '">' + Result[i]["full_name"] + ' </option>');
                if (Result[i]["is_orgin"] == 1) {
                    suborgin = Result[i]["ref_no"];
                }

            }
            if (Result.length > 1) {
                $('#divDdlClient').removeClass("hide");
            }

            //if (subclientid == suborgin) {
            //    $('#divDdlClient').addClass("hide");
            //}

            //$("select#ddlSubClient")[0].selectedIndex = 0;
            ////document.getElementById("ddlSubClient").selectedIndex = 1;
            //$('#ddlSubClient').trigger("change");


        }


    }
    function BindClientFee(ddltype) {
        var Condition = "where client_id=" + EmpId + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsClientFee");
        if (Result != "" && Result != null) {

            var ddlvalue = ddltype.value;

            if (ddlvalue == 1) {
                $('#txtdefee').val(Result[Result.length - 1]["data_int_fee"]);
                $('#txtphtfee').val(Result[Result.length - 1]["photo_int_fee"]);
            } else {
                $('#txtdefee').val(Result[Result.length - 1]["data_ext_fee"]);
                $('#txtphtfee').val(Result[Result.length - 1]["photo_ext_fee"]);
            }

            $('#txtqafee').val(Result[Result.length - 1]["qa_fee"]);
        }
    }

    function BindOrderValue(ddlordevalue) {
        var ddlvalue = ddlordevalue.value;

        var Condition = "where client_id=" + EmpId + " and portal_id=" + ddlvalue + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectClientPortalList");
        if (Result != "" && Result != null) {
            if ($("#ddlorderType").val() == 1) {
                $("#txtordervalue").val(Result[0]["order_int_value"])
            } else if ($("#ddlorderType").val() == 2) {
                $("#txtordervalue").val(Result[0]["order_ext_value"])
            }
            else {
                $("#txtordervalue").val("0");
            }
        }



    }


    function BindCounty() {

        var sStateId = $('#ddlstate').val();
        var Condition = "where delete_status=0 and state_id=" + sStateId + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsCounty");
        $('#ddlcounty').empty().append();
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlcounty').append('<option value="' + Result[i]["county_id"] + '">' + Result[i]["county_name"] + '</option>');
            }
        }
    }
    function BindCity() {
        var sStateId = $('#ddlstate').val();
        var Condn = "where delete_status=0 and state_id=" + sStateId + "";
        var strJsonDatas = eval({ strCondition: Condn, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsCity");
        $('#ddlcity').empty().append();
        $('#ddlcity').append('<option></option>');
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlcity').append('<option value="' + Result[i]["city_id"] + '">' + Result[i]["city_name"] + '</option>');
            }
        }
    }


    function Bindenumkey() {
        var ordid = $('#hdnOrderId').val();
        for (var i = 0; i < parent.jsonEnum.length; i++) {
            if (parent.jsonEnum[i]["enumkey"] == 'order_status')
                $('#ddlstatus').append('<option value="' + parent.jsonEnum[i]["id"] + '">' + parent.jsonEnum[i]["name"] + '</option>');
            else if (parent.jsonEnum[i]["enumkey"] == 'Order_Type')
                $('#ddlorderType').append('<option value="' + parent.jsonEnum[i]["id"] + '">' + parent.jsonEnum[i]["name"] + '</option>');
            else if (parent.jsonEnum[i]["enumkey"] == 'photo_File_name') {
                //$("select[name=photoddl_m]").append('<option value="' + Result[i]["value"] + '">' + ordid + '_' + Result[i]["short_display"] + '</option>');
                ddl_m_opt_id.push(parent.jsonEnum[i]["id"]);
                ddl_m_opt_val.push(ordid + '_' + parent.jsonEnum[i]["name"]);
                filename.push(parent.jsonEnum[i]["name"])
            }
        }
    }


    function BindOrderType() {
        var Condition = "where enumeration_key='Order_Type' order by 1 asc";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsStatus");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlorderType').append('<option value="' + Result[i]["value"] + '">' + Result[i]["short_display"] + '</option>');
            }
        }
    }

    function BindPhotographer() {

        //var sStateId = $('#ddlstate').val();
        if (access_level == 2) {
        }
        else {
            $("#ddlpht").prop("disabled", true);
        }


        for (var i = 0; i < parent.jsonPhotographer.length; i++) {
            $('#ddlpht').append('<option value="' + parent.jsonPhotographer[i]["ref_no"] + '">' + parent.jsonPhotographer[i]["full_name"] + '</option>');
        }
    }
    function BindState() {
        //var Condition = "where delete_status=0";
        //var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        //var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsState");
        //if (Result != "" && Result != null) {
        for (var i = 0; i < parent.jsonState.length; i++) {
            $('#ddlstate').append('<option value="' + parent.jsonState[i]["state_id"] + '">' + parent.jsonState[i]["state_name"] + ' , ' + parent.jsonState[i]["state_abb"] + '</option>');
        }
        //}
    }

    function BindPortal() {
        $('#ddlportal').empty().change();
        $('#ddlportal').append('<option></option>');
        if (access_level == 2) {

        }
        else {

            $("#ddlportal").prop("disabled", true);
            var element = document.getElementById('ddlportal');
            element.setAttribute('disabled', 'disabled');
        }

        for (var i = 0; i < parent.jsonPortal.length; i++) {
            $('#ddlportal').append('<option value="' + parent.jsonPortal[i]["portal_id"] + '">' + parent.jsonPortal[i]["portal_name"] + '</option>');
        }

    }

    function BindOrderStatus() {
        var Condition = "where enumeration_key='Order_Status' order by value asc";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectBtsStatus");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                $('#ddlstatus').append('<option value="' + Result[i]["value"] + '">' + Result[i]["short_display"] + '</option>');
            }
        }
    }
    function BindDataentry() {
        //var Condition = "where user_type=3 and delete_status=0";
        //var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        //var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
        //if (Result != "" && Result != null) {
        for (var i = 0; i < parent.jsonDataEntry.length; i++) {
            $('#ddldataentry').append('<option value="' + parent.jsonDataEntry[i]["ref_no"] + '">' + parent.jsonDataEntry[i]["full_name"] + '</option>');
            $('#ddlqa').append('<option value="' + parent.jsonDataEntry[i]["ref_no"] + '">' + parent.jsonDataEntry[i]["full_name"] + '</option>');
        }
        //}
    }

    function SaveData() {
        //if (tabid == "3_Photo") {
        //    updatephotos();
        //}
        //if (tabid == "1_gen" || tabid == "2_fee") {
        //    InsertOrder_Genfee();
        //}

        InsertOrder_Genfee();

    }
    //---General Tab-----
    function sendmailneworder(code) {
        loader(0);
        var ordid = $('#hdnOrderId').val();
        var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
        var sMailBody = "<b>New Order created</b>";

        //mail for photographer
        var addressname = $('#txtsubaddress').val();
        var sSubAddress = addressname.replace("\t", " ");
        var sPhotogrphername = ""; var sPhotographermail = "";
        var Condition = "Where ref_no=" + $("#ddlpht").val() + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
        if (Result != "" && Result != null) {
            sPhotogrphername = Result[0]["full_name"];
            sMailTo = Result[0]["email_id"];
            sMailBody = CreateMailBody_neworder("pg", sPhotogrphername);
        }
        StrJsonDatas = eval({
            mail_to: sMailTo,
            mail_subject: 'New order created for the subject: ' + sSubAddress,
            mail_body: sMailBody
        });
        Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
        if (Result != null || Result != '') {

            //CreateMailLog();
        }


        //Mail for data Entry
        sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
        sMailBody = "<b>New Order created</b>";
        var sDename = ""; var sDemail = "";
        Condition = "Where ref_no=" + $("#ddldataentry").val() + "";
        strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
        if (Result != "" && Result != null) {
            sDename = Result[0]["full_name"];
            sMailTo = Result[0]["email_id"];
            sMailBody = CreateMailBody_neworder("de", sDename);
        }

        StrJsonDatas = eval({
            mail_to: sMailTo,
            mail_subject: 'New order created for the subject: ' + sSubAddress,
            mail_body: sMailBody

        });
        Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
        if (Result != null || Result != '') {
            
            //setTimeout(function () {
            msgalert('Success', 'New order added successfully with order no ' + code + '', 1);//sucess-1, warning-2, error-3
            setTimeout(function () {
                try {
                    if (listflag == 1) {
                        parent.$('#myModalAddNew').modal('hide');
                        parent.$("#framecontentlist").contents().find("#btnRefresh").click();
                        parent.document.getElementById('frmneworder').src = "";
                        parent.document.getElementById('frmneworder').src = "../Process/OrderManagement?flag=1";
                    }
                    else {
                        parent.document.getElementById('framecontent').src = '../Process/OrderManagement';
                    }
                }
                catch (e) { }


            }, 1000);
            //}, 1000);

            //CreateMailLog();
        }

    }

    function CreateMailBody_neworder(sendto, name) {
        var addressname = $('#txtsubaddress').val();
        var sSubAddress = addressname.replace("\t", " ");
        var sOrderTyped = $('#ddlorderType option:selected').text();
        document.getElementById('MailData').innerHTML = "";
        if (sendto == "pg") {

            var sNotes = $('#txtnotepg').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderTyped;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }
        else if (sendto == "de") {

            var sNotes = $('#txtnotede').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderTyped;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }

    }
    function SendMailOrderUpdation(code, sChangeType) {
        
        loader(0);
        var addressname = $('#txtsubaddress').val();
        var sSubAddress = addressname.replace("\t", " ");
        var rtn = ""
        if (sChangeType == 'sOrderType') {
           
            var ordid = $('#hdnOrderId').val();
            var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            var sMailBody = "<b>Order type changed</b>";
            //mail for photographer
            var sSubAddress = $('#txtsubaddress').val();

            var sPhotogrphername = ""; var sPhotographermail = "";
            var Condition = "Where ref_no=" + $("#ddlpht").val() + "";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sPhotogrphername = Result[0]["full_name"];
                sMailTo = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("pg", sPhotogrphername);
            }
            StrJsonDatas = eval({
                mail_to: sMailTo,
                mail_subject: 'Order type changed: ' + sSubAddress,
                mail_body: sMailBody
            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');

            //Mail for data Entry
            sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            sMailBody = "<b>Order type changed</b>";
            var sDename = ""; var sDemail = "";
            Condition = "Where ref_no=" + $("#ddldataentry").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("de", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Order type changed: ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
            if (Result != "" && Result != null) {
              
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }
            //else
            //{
            //    loader(0);
            //}

        }
        else if (sChangeType == 'sPhotoghr') {

            var ordid = $('#hdnOrderId').val();
            var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            var sMailBody = "<b>New Order created</b>";
            //mail for photographer
            var sSubAddress = $('#txtsubaddress').val();

            var sPhotogrphername = ""; var sPhotographermail = "";
            var Condition = "Where ref_no=" + $("#ddlpht").val() + "";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sPhotogrphername = Result[0]["full_name"];
                sMailTo = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("pg", sPhotogrphername);
            }
            StrJsonDatas = eval({
                mail_to: sMailTo,
                mail_subject: 'New order created for the subject: ' + sSubAddress,
                mail_body: sMailBody
            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');

            //Mail for data Entry
            sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            sMailBody = "<b>Photographer changed</b>";
            var sDename = ""; var sDemail = "";
            Condition = "Where ref_no=" + $("#ddldataentry").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("de", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Photographer changed: ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');

            //Mail for Existing Photographer
            var ordid = $('#hdnOrderId').val();
            var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            var sMailBody = "<b>Order Deleted</b>";

            var sSubAddress = $('#txtsubaddress').val();

            var sPhotogrphername = ""; var sPhotographermail = "";
            var Condition = "Where ref_no=" + sgExistPhtId + "";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sPhotogrphername = Result[0]["full_name"];
                sMailTo = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("sExstPh", sPhotogrphername);
            }
            StrJsonDatas = eval({
                mail_to: sMailTo,
                mail_subject: 'Order Deleted for the subject: ' + sSubAddress,
                mail_body: sMailBody
            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');

            if (Result != "" && Result != null) {
                loader(0);
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }

        }
        else if (sChangeType == 'sNotesToPg') {

            var ordid = $('#hdnOrderId').val();
            var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            var sMailBody = "<b>Notes added for photographer</b>";
            //mail for photographer
            var sSubAddress = $('#txtsubaddress').val();

            var sPhotogrphername = ""; var sPhotographermail = "";
            var Condition = "Where ref_no=" + $("#ddlpht").val() + "";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sPhotogrphername = Result[0]["full_name"];
                sMailTo = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("pg", sPhotogrphername);
            }
            StrJsonDatas = eval({
                mail_to: sMailTo,
                mail_subject: 'Notes added for photographer: ' + sSubAddress,
                mail_body: sMailBody
            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
            if (Result != "" && Result != null) {
                loader(0);
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }
            //else {
            //    loader(0);
            //}

        }
        else if (sChangeType == 'sNotesToDe') {

            //Mail for data Entry
            sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            sMailBody = "<b>Notes added for dataentry</b>";
            var sDename = ""; var sDemail = "";
            Condition = "Where ref_no=" + $("#ddldataentry").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("de", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Notes added for dataentry: ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
            if (Result != "" && Result != null) {
                loader(0);
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }
            //else {
            //    loader(0);
            //}
        }
        else if (sChangeType == 'sNotesFromData') {

            //Mail for Client
            sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            sMailBody = "<b>Notes added from dataentry</b>";
            var sDename = ""; var sDemail = "";
            Condition = "Where ref_no=" + $("#hdnPostedBy").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sClientName = Result[0]["full_name"];
                sClientMailId = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("Ct", sClientName);
            }

            StrJsonDatas = eval({
                mail_to: sClientMailId,
                mail_subject: 'Notes added from dataentry: ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');
            if (Result != "" && Result != null) {
                loader(0);
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }
            //else {
            //    loader(0);
            //}
        }
        else if (sChangeType == 'sOrderStatus') {
            var sOrderStatus = $('#ddlstatus option:selected').text();
            //Mail To DataEntry
            sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
            sMailBody = "<b>Order " + sOrderStatus + "</b>";
            var sDename = ""; var sDemail = "";
            Condition = "Where ref_no=" + $("#ddldataentry").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("ForStatusChg", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Order ' + sOrderStatus + ': ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');


            Condition = "Where ref_no=" + $("#ddlpht").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("ForStatusChg", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Order ' + sOrderStatus + ': ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');


            Condition = "Where ref_no=" + $("#hdnPostedBy").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sDename = Result[0]["full_name"];
                sDemail = Result[0]["email_id"];
                sMailBody = UpdateMailBody_neworder("ForStatusChg", sDename);
            }

            StrJsonDatas = eval({
                mail_to: sDemail,
                mail_subject: 'Order ' + sOrderStatus + ': ' + sSubAddress,
                mail_body: sMailBody

            });
            Result = oAPICall.Sendmail(StrJsonDatas, 'sendmailwithoutattachment');

            if (Result != "" && Result != null) {
                loader(0);
                msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
                parent.$('#framecontent').hide();
                parent.$('#framecontentlist').show();
                if (sIsPageID == undefined)
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                else
                    parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                parent.$('.modal-backdrop').remove();
                parent.$("#pagename").text(sPageName);
                parent.$("#SubModTitle").text(sPageName);
            }

            //else {
            //    loader(0);
            //}
        }
    }

    function UpdateMailBody_neworder(sendto, name) {
        var sSubAddress = $('#txtsubaddress').val();
        var sOrderType = $('#ddlorderType option:selected').text();
        document.getElementById('MailData').innerHTML = "";
        if (sendto == "pg") {

            var sNotes = $('#txtnotepg').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderType;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }

        else if (sendto == "sExstPh") {

            var sNotes = $('#txtremarks').val();
            var Condition = ' where mail_type=8 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sReason').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }
        else if (sendto == "de") {

            var sNotes = $('#txtnotede').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderType;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }
        else if (sendto == "Ct") {

            var sNotes = $('#txtnotefde').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderType;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }
        else if (sendto == "ForStatusChg") {
            var sOrderStName = $('#ddlstatus option:selected').text();
            var sNotes = 'This Order Status has been changed into ' + sOrderStName + $('#txtnotede').val();
            var Condition = ' where mail_type=3 '; // mail type 3  is New order Creation
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

            if (Result != null || Result != '') {
                var sMailData = Result[0].mail_body;

                document.getElementById('MailData').innerHTML = sMailData;
                document.getElementById('destiname').innerHTML = name;
                document.getElementById('address').innerHTML = sSubAddress;
                document.getElementById('sOrdertype').innerHTML = sOrderType;
                document.getElementById('snotes').innerHTML = sNotes;
                document.getElementById('company_address').innerHTML = CompanyName;

            }
            return document.getElementById('MailData').innerHTML;
        }
    }




    function InsertOrder_Genfee() {
        if (document.getElementById('ddlSubClient').value == "") {
            document.getElementById('ddlSubClient').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please select subclient and continue..!', 2);
            $('#ddlSubClient').focus();
            return;
        }

        if (document.getElementById('txtsubaddress').value == "") {
            document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please enter address and continue..!', 2);
            $('#txtsubaddress').focus();
            return;
        }



        if (!isNaN(document.getElementById('txtsubaddress').value)) {
            document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Address should be character or alpha numeric..!', 2);
            $('#txtsubaddress').focus();
            return;
        }



        if (document.getElementById('txtzipcode').value == "") {
            document.getElementById('txtzipcode').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please enter Zipcode and continue..!', 2);
            $("#1_gen").trigger("click");
            $('#txtzipcode').focus();
            return;
        }
        if (document.getElementById('txtorderportalno').value == "") {
            document.getElementById('txtorderportalno').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please enter order no. and continue..!', 2);
            $("#1_gen").trigger("click");
            $('#txtorderportalno').focus();
            return;
        }
        if (document.getElementById('ddlorderType').value == "") {
            document.getElementById('ddlorderType').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Select Order Type and continue..!', 2);
            $("#1_gen").trigger("click");
            $('#ddlorderType').focus();
            return;
        }
        if (document.getElementById('ddlportal').value == "") {
            document.getElementById('ddlportal').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Select Portal and continue..!', 2);
            $("#2_fee").trigger("click");

            $('#ddlportal').focus();
            return;
        }
        if (document.getElementById('ddlpht').value == "") {
            document.getElementById('ddlpht').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Select Photographer and continue..!', 2);
            $("#2_fee").trigger("click");
            $('#ddlpht').focus();
            return;
        }
        if (document.getElementById('ddlstatus').value == "") {
            document.getElementById('ddlstatus').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Select Order status and continue..!', 2);
            $("#2_fee").trigger("click");
            $('#ddlstatus').focus();
            return;
        }

        if (document.getElementById('txtphtfee').value == "") {
            document.getElementById('txtphtfee').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Enter Photographer Fee and continue..!', 2);
            $("#2_fee").trigger("click");
            $('#txtphtfee').focus();
            return;
        }
        if (document.getElementById('txtdefee').value == "") {
            document.getElementById('txtdefee').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Enter Dataentry Fee and continue..!', 2);
            $("#2_fee").trigger("click");
            $('#txtdefee').focus();
            return;
        }
        if (document.getElementById('txtordervalue').value == "") {
            document.getElementById('txtordervalue').style.borderColor = "red";// this adds the error class
            msgalert('Warning', 'Please Enter Order value and continue..!', 2);
            $("#2_fee").trigger("click");
            $('#txtordervalue').focus();
            return;
        }


        //if (document.getElementById('ddlpht').value == "") {
        //    document.getElementById('ddlpht').style.borderColor = "red";// this adds the error class
        //    msgalert('Warning', 'Please Select Photographer and continue..!', 2);
        //    $("#2_fee").trigger("click");
        //    $('#ddlpht').focus();
        //    return;
        //}

        var sLatitude = 0;
        var sLongitude = 0;
        var subadd = $.trim($("#txtsubaddress").val());
        //$.ajax({
        //    url: "http://maps.googleapis.com/maps/api/geocode/json?address=" + subadd + "&sensor=false",
        //    type: "POST",
        //    success: function (res) {
        //        if (res.status != "ZERO_RESULTS") {
        //            sLatitude = res.results[0].geometry.location.lat;
        //            sLongitude = res.results[0].geometry.location.lng;
        //        }
        //    }
        //});


        var sOrderId = $('#hdnOrderId').val();
        if (sOrderId <= 0 && sOrderId == "") {

            if ($('#txtsubaddress').val().length < 20) {
                document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
                msgalert('Warning', 'Please enter full address and continue..!', 2);
                $('#txtsubaddress').focus();
                return;
            }

            ////var sIsclient = 1;//1 is client type
            //var sMsgDesc = 'New Order added successfully'

            //var cudate = new Date();
            //cudate = FormatCurrentDate("yyyy-mm-dd", cudate);

            ////var dt = new Date();
            //dt = cudate.split("-");
            //var cdt = dt[1] + "/" + dt[2] + "/" + dt[0];
            ////var res = dt.replace("T", " ");
            //var time = FormatTimeAMPM(new Date());
            var cudate = oAPICall.GetServerDateOm();
            var order_due_date = $('#txtdob').val() + " " + $('#txtdobtime').val();
            var photo_due_date = $('#txtphtduedate').val() + " " + $('#txtphtoduetime').val();

            //cudate = cudate +" "+ $("#txtdobtime").val();
            var sSubAdd = $('#txtsubaddress').val();
            var sSubjAddrss = sSubAdd.replace("\t", " ");
            var StrJsonDatas = eval({
                order_code: "",
                subclient_id: $('#ddlSubClient').val(),
                subject_address: sSubjAddrss,
                state_id: $('#ddlstate').val(),
                city_id: $('#ddlcity').val(),
                zip_code: $('#txtzipcode').val(),
                order_portal_no: $('#txtorderportalno').val(),
                order_due_date: order_due_date,
                order_type: $('#ddlorderType').val(),
                remarks: $('#txtremarks').val(),
                notes_for_pht: $('#txtnotepg').val(),
                notes_for_dataentry: $('#txtnotede').val(),
                notes_for_qa: $('#txtnoteqa').val(),
                notes_from_pht: $('#txtnotefpg').val(),
                notes_from_dataentry: $('#txtnotefde').val(),
                notes_from_qa: $('#txtnotefqa').val(),

                portal_id: $('#ddlportal').val(),
                order_status: $('#ddlstatus').val(),
                photo_due_date: photo_due_date,
                photographer_id: $('#ddlpht').val(),
                dataentry_id: $('#ddldataentry').val(),
                qa_id: $('#ddlqa').val(),
                photo_fee: $('#txtphtfee').val(),
                data_fee: $('#txtdefee').val(),
                qa_fee: $('#txtqafee').val(),
                order_value: $('#txtordervalue').val(),

                is_entry_comp: 0,
                is_paid: 0,
                count_photo_upload: 0,
                is_photo_upload: 0,
                count_file_upoad: 0,
                is_bulk_order: 0,
                order_date: cudate,
                latitude: sLatitude,
                longitude: sLongitude,
                delete_status: 0,
                created_by: CurrentUser,
                order_posted_by: EmpId,
                created_date: cudate

            });
            loader(1);



            var Result = oAPICall.InsertData(StrJsonDatas, 'CreateOrder');

            //alert(Result_om);
            if (Result != null && Result != '') {

                $('#hdnOrderId').val(Result[0].IDENTITY);
                //alert(Result[0].IDENTITY);// Sameer
                insertordertotfs(Result[0].IDENTITY);

                setTimeout(function () {
                    sendmailneworder($('#txtorderportalno').val());
                }, 1000);
                //PopulateOrderData(Result[0].IDENTITY, 0);

            }
            else {
                msgalert('Error', 'Order not created.. Please try again.', 3);//sucess-1, warning-2, error-3
            }

        }

        else {


            for (var i = 0; i < ddl_m_id.length; i++) {
                if ($("#" + ddl_m_id[i]).val() == "" || $("#" + ddl_m_id[i]).val() == null || $("#" + ddl_m_id[i]).val() == 0) {
                    //setTimeout(function () {
                    $("#3_Photo").trigger("click");
                    msgalert('Warning', 'Please select photos name and continue..!', 2);
                    //}, 500);

                    //$("#3_Photo").trigger("click");
                    $("#" + ddl_m_id[i]).focus();
                    return;
                }
            }


            for (var i = 0; i < txt_opt_id.length; i++) {
                if ($("#" + txt_opt_id[i]).val() == "" || $("#" + txt_opt_id[i]).val() == null) {

                    $("#3_Photo").trigger("click");
                    $("#" + txt_opt_id[i]).focus();
                    msgalert('Warning', 'Please Enter file name and continue..!', 2);
                    return
                }
            }

            //......................................Order update...........................
            parent.swal({
                title: "Are you sure to update order no " + document.getElementById("tLblOrderNo").innerHTML + " ?",
                //text: "" + text + "",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes",
                cancelButtonText: "No",
                closeOnConfirm: true,
                closeOnCancel: true,
                //showLoaderOnConfirm: true,

            },
       function (isConfirm) {

           if (isConfirm) {


               //$(".confirm").addClass('ladda-button-demo');
               //var l = $('.ladda-button-demo').ladda();
               //l.ladda('start');


               var Condition = "Where order_no=" + sOrderId + "";
               var photoid;
               //var no_photo = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
               //var no_files = $("input[name=addressfile]").length;
               //var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
               if (access_level == 3) {
                   photoid = EmpId;
               }
               else {
                   photoid = $('#ddlpht').val();
               }

               if ($('#ddlstatus').val() == 2) {
                   sIsDataEntryComp = 1;
               }
               if ($('#ddlstatus').val() == 3) {
                   sIsPaid = 1;
               }

               var StrJsonDatas = eval({
                   state_id: $('#ddlstate').val(),
                   subclient_id: $('#ddlSubClient').val(),
                   subject_address: $('#txtsubaddress').val(),
                   city_id: $('#ddlcity').val(),
                   zip_code: $('#txtzipcode').val(),
                   order_portal_no: $('#txtorderportalno').val(),
                   order_due_date: $('#txtdob').val() + " " + $('#txtdobtime').val(),
                   order_type: $('#ddlorderType').val(),
                   remarks: $('#txtremarks').val(),
                   notes_for_pht: $('#txtnotepg').val(),
                   notes_for_dataentry: $('#txtnotede').val(),
                   notes_for_qa: $('#txtnoteqa').val(),
                   notes_from_pht: $('#txtnotefpg').val(),
                   notes_from_dataentry: $('#txtnotefde').val(),
                   notes_from_qa: $('#txtnotefqa').val(),
                   portal_id: $('#ddlportal').val(),
                   order_status: $('#ddlstatus').val(),
                   photo_due_date: $('#txtphtduedate').val() + " " + $('#txtphtoduetime').val(),
                   photographer_id: photoid,
                   dataentry_id: $('#ddldataentry').val(),
                   qa_id: $('#ddlqa').val(),
                   photo_fee: $('#txtphtfee').val(),
                   data_fee: $('#txtdefee').val(),
                   order_value: $('#txtordervalue').val(),
                   qa_fee: $('#txtqafee').val(),
                   is_entry_comp: sIsDataEntryComp,
                   is_paid: sIsPaid,
                   updated_by: CurrentUser,
                   updated_date: new Date()
               });

               loader(1);
               setTimeout(function () {
                   if ($('#ddlstatus').val() == 7) {

                       if (sIsDataEntryComp != 1) {
                           msgalert('Warning', 'Data Entry not completed..!', 2);
                           loader(0);
                           return;
                       }
                       else if (sIsPhotoUpld == 0) {
                           msgalert('Warning', 'Photo(s) not found..!', 2);
                           loader(0);
                           return;
                       }
                   }
                   var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateOrder", Condition);
                   var rtval = "";
                   if (Result == "Success") {

                       //msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3


                       updateordertotfs(sOrderId);//Sameer
                       updatephotos();
                       //if (rtval = "0") {

                       ////}
                       //alert(rtval)
                      
                       // PopulateOrderData(sOrderId, 0);

                   }
                   else {
                       msgalert('Error', 'Update Failed try again ', 3);//sucess-1, warning-2, error-3
                   }


               }, 1200);

               
           }
           else {
               return
           }
       });

        }
        //loader(1)
        //maildphotos();

    }

    function insertordertotfs(btsorderid) {

        var data = [];
        //  data = GetUrgencyPriority(2, 1, 2);
        var sPriorityParamId = 11;//data[0].PriorityParamId;
        var master_account_no = "";
        var hierarchy_id = null;
        //var sCondition = " WHERE CM_DELETESTATUS=0 and bts_client_id=" + EmpId + "";
        //var strJsonDatas = eval({ strCondition: sCondition, strFieldNames: null, strSessionID: UserSession });
        //var Result = oAPICall.SelectData(strJsonDatas, "SelectClientTFS");
        if (parent.sClientListTFS != '' && parent.sClientListTFS != null) {
            for (var i = 0; i < parent.sClientListTFS.length; i++) {
                if (parent.sClientListTFS[i].bts_client_id == EmpId)
                    master_account_no = parent.sClientListTFS[i].CM_CUSTOMER_ID;
                if (parent.sClientListTFS[i].bts_sub_client_id == $('#ddlSubClient').val())
                    hierarchy_id = parent.sClientListTFS[i].CM_CUSTOMER_ID;
            }
        }


        //var sCondition = " WHERE CM_DELETESTATUS=0 and bts_sub_client_id=" + $('#ddlSubClient').val() + "";
        //var strJsonDatas = eval({ strCondition: sCondition, strFieldNames: null, strSessionID: UserSession });
        //var Result = oAPICall.SelectData(strJsonDatas, "SelectClientTFS");

        var cudate = oAPICall.GetServerDateOm();
        var order_due_date = $('#txtdob').val() + " " + $('#txtdobtime').val();
        var StrJsonDatasom = eval({
            order_date: cudate,
            master_account_no: master_account_no,
            hierarchy_id: hierarchy_id,
            subject_address: $('#txtsubaddress').val(),
            state_id: $('#ddlstate').val(),
            order_type: $('#ddlorderType').val(),
            order_urgency: "1",//Rush
            order_priority: "2",// High
            clarification_status: "0",
            photo_req_status: "0",
            status_id: "1",
            status_reason_id: "11",
            emp_ref_no: "-1",
            delete_status: 0,
            remarks: $('#txtremarks').val(),
            site_ref_no: $('#ddlportal').val(),
            mls_site_ref_no: "0",
            is_review_checked: "0",
            due_date: order_due_date,
            priority_param_id: sPriorityParamId,
            bts_order_id: btsorderid,
            is_from_bts: 1,
            photo_req_status: 1
        });
        var Result_om = oAPICall.InsertData(StrJsonDatasom, 'CreateOrderom');

    }
    function updateordertotfs(btsorderid) {

        var Condition = "Where bts_order_id=" + btsorderid + "";
        var photo_req_status = "1";
        var hierarchy_id = null;

        //var sCondition = " WHERE CM_DELETESTATUS=0 and bts_sub_client_id=" + $('#ddlSubClient').val() + "";
        //var strJsonDatas = eval({ strCondition: sCondition, strFieldNames: null, strSessionID: UserSession });
        //var Result = oAPICall.SelectData(strJsonDatas, "SelectClientTFS");
        //if (Result != '' && Result != null) {
        //    hierarchy_id = Result[0].CM_CUSTOMER_ID;
        //}

        if (parent.sClientListTFS != '' && parent.sClientListTFS != null) {
            for (var i = 0; i < parent.sClientListTFS.length; i++) {
                if (parent.sClientListTFS[i].bts_sub_client_id == $('#ddlSubClient').val())
                    hierarchy_id = parent.sClientListTFS[i].CM_CUSTOMER_ID;
            }
        }

        var no_photo = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;

        if (no_photo != 0 || sIsPhotoExist == 1) {
            photo_req_status = "2";
        }

        if ($('#ddlstatus').val() == 4 || $('#ddlstatus').val() == 5 || sOrderStatus == 4 || sOrderStatus == 5) {
            var status_id;
            var status_reason_id;
            if ($('#ddlstatus').val() == 4) {
                status_id = 11;
                status_reason_id = 32;
            }
            else if ($('#ddlstatus').val() == 5) {
                status_id = 12;
                status_reason_id = 33;
            }
            else if ($('#ddlstatus').val() != sOrderStatus && $('#ddlstatus').val() == 1) {
                status_id = 1;
                status_reason_id = 11;
            }
           
            var order_due_date = $('#txtdob').val() + " " + $('#txtdobtime').val();
            var StrJsonDatasom = eval({
                state_id: $('#ddlstate').val(),
                hierarchy_id: hierarchy_id,
                subject_address: $('#txtsubaddress').val(),
                order_type: $('#ddlorderType').val(),
                remarks: $('#txtremarks').val(),
                site_ref_no: $('#ddlportal').val(),
                due_date: order_due_date,
                status_id: status_id,
                status_reason_id: status_reason_id,
                photo_req_status: photo_req_status
            });

        }
        else {
            var order_due_date = $('#txtdob').val() + " " + $('#txtdobtime').val();
            var StrJsonDatasom = eval({
                state_id: $('#ddlstate').val(),
                hierarchy_id: hierarchy_id,
                subject_address: $('#txtsubaddress').val(),
                order_type: $('#ddlorderType').val(),
                remarks: $('#txtremarks').val(),
                site_ref_no: $('#ddlportal').val(),
                due_date: order_due_date,
                photo_req_status: photo_req_status

            });
        }


        var Result = oAPICall.UpdateData(StrJsonDatasom, "UpdateOrderom", Condition);
        //var Result_om = oAPICall.InsertDataom(StrJsonDatasom, 'CreateOrderom');
    }


    function GetUrgencyPriority(sPrioOrderId, sUrgency, sPriority) {

        try {

            var oAPICall = new APICall();
            var Condition = "WHERE priority_order_id = " + sPrioOrderId + " AND priority_order_urgency = " + sUrgency + " AND priority_order_priority = " + sPriority + " ORDER BY priority_tier_id";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: null });
            var Result = oAPICall.SelectData(strJsonDatas, "SelectPriorityTierMap");

            if (Result != "" && Result != null) {
                var data = [];
                for (var i = 0; i < 1; i++) {

                    var sPriorityTierId = Result[i].priority_tier_id;

                    data[i] = {
                        PriorityParamId: sPriorityTierId
                    };
                }
            }

            return data;

        }
        catch (exception) {
        }
    }




    //--------------Photo update
    function updatephotos() {
        var bit = "";
        var photoid = "";
        var ordid = $('#hdnOrderId').val();
        var Condition_attachment = "Where OrderID=" + ordid + " and UserID=" + EmpId + "";
        var Condition_order = "Where order_no=" + ordid + "";
        //var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var StrJsonDatas_attachment = eval({ maild: 1 });


        //function updatefiename(ordid) {
        //    for (var i = 0; i < unmaildphoto.length; i++) {
        //        var Condition = "Where OrderID=" + ordid + " and AttachmentID=" + unmaildphoto[i] + "";
        //        var StrJsonDatas = eval({
        //            DisplayName: $("#ddl_" + unmaildphoto[i]).val(),
        //        });
        //        var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateFileAttachment", Condition);
        //    }

        //}




        var no_photo = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
        var no_files = $("input[name=addressfile]").length;
        var sIsPhtUplaod = 0;
        if (no_photo > 0 || sIsPhotoExist == 1)
            sIsPhtUplaod = 1;
        var StrJsonDatas_order = eval({
            count_photo_upload: no_photo,
            count_file_upoad: no_files,
            is_photo_upload: sIsPhtUplaod
        });

        var Result_attachment = oAPICall.UpdateData(StrJsonDatas_attachment, "UpdateFileAttachment", Condition_attachment);

        //updatefiename(ordid);
        if (Result_attachment == "Success") {
            var Result_order = oAPICall.UpdateData(StrJsonDatas_order, "UpdateOrder", Condition_order);

            if (Result_order == "Success") {
                unmaildphoto_opt = [];

                //if (unmaildphoto.length + unmaildphoto_opt.length != 0) {
                if (unmaildphoto.length != 0) {
                    setTimeout(function () {
                        maildphotos();
                        loadimages(1);
                        loadimages(3);
                        loadfiles();
                    }, 1500);
                }

                else {
                    loadimages(1);
                    loadimages(3);
                    loadfiles();

                    if ($('#txtnotepg').val() != "") {
                        if (sNotesToPht != $('#txtnotepg').val()) {
                            bit = 1;
                            //loader1(1);
                            SendMailOrderUpdation(ordid, "sNotesToPg");
                        }
                    }
                    if ($('#txtnotefpg').val() != "") {
                        if (sNotesFromPht != $('#txtnotefpg').val()) {
                            bit = 1;
                            //loader(1);
                            setTimeout(function () {
                                maildphotos();
                            }, 1000);
                        }

                    }
                    else {
                        if ($('#ddlorderType').val() != sOrderType) {
                            //loader(1);
                            bit = 1;
                            SendMailOrderUpdation(ordid, "sOrderType");
                        }

                        if (access_level == 3) {
                            photoid = EmpId;
                        }
                        else {
                            photoid = $('#ddlpht').val();
                        }

                        if (photoid != sPhtId) {
                            bit = 1;
                            SendMailOrderUpdation(ordid, "sPhotoghr");
                        }

                        if ($("#txtnotede").val() != "") {
                            if (sNotesToData != $("#txtnotede").val()) {
                                bit = 1;
                                SendMailOrderUpdation(ordid, "sNotesToDe");
                            }
                        }
                        if ($("#txtnotefde").val() != "") {
                            if (sNotesFromData != $("#txtnotefde").val()) {
                                bit = 1;
                                SendMailOrderUpdation(ordid, "sNotesFromData");
                            }
                        }
                        if ($("#ddlstatus").val() != sOrderStatus) {
                            if ($("#ddlstatus").val() == 5 || $("#ddlstatus").val() == 6 || $("#ddlstatus").val() == 4) {
                                bit = 1;
                                SendMailOrderUpdation(ordid, "sOrderStatus");
                            }
                        }
                    }


                    //setTimeout(function () {
                    if (bit == "") {

                        //alert(bit);
                        loader(0)
                        msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully..1 ', 1);//sucess-1, warning-2, error-3
                       
                        parent.$('#framecontent').hide();
                        parent.$('#framecontentlist').show();
                       // window.parent.$('#framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                        if (sIsPageID == undefined)
                            parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                        else
                            parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                        parent.$('.modal-backdrop').remove();
                        parent.$("#pagename").text(sPageName);
                        parent.$("#SubModTitle").text(sPageName);
            
                    }
                    //}, 1000);
                    //alert(bit);
                    //loader(0)
                    //msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3


                }
            }
            else {
                loadimages(1);
                loadimages(3);
                loadfiles();
                //loader(0)
                //msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully ', 1);//sucess-1, warning-2, error-3
            }

        }


        else {
            msgalert('Error', 'Update Failed try again ', 3);//sucess-1, warning-2, error-3
            loadimages(1);
            loadimages(3);
            loadfiles();
        }

        //alert("File not mailed");



    }

    function updatefiename(ordid) {

        var ordid = $('#hdnOrderId').val();

        var Condition_list = "Where OrderID=" + ordid + "";
        var strJsonDatas_list = eval({ strCondition: Condition_list, strFieldNames: null, strSessionID: UserSession });
        var Result_list = oAPICall.SelectData(strJsonDatas_list, "GetPhotos");


        for (var i = 0; i < Result_list.length; i++) {
            if (Result_list[i]["Type"] == 1) {
                var Condition = "Where OrderID=" + ordid + " and AttachmentID=" + Result_list[i]["AttachmentID"] + "";
                var StrJsonDatas = eval({
                    DisplayName: $("#ddl_" + Result_list[i]["AttachmentID"]).val(),
                });
                var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateFileAttachment", Condition);
            }

            if (Result_list[i]["Type"] == 3) {
                var Condition = "Where OrderID=" + ordid + " and AttachmentID=" + Result_list[i]["AttachmentID"] + "";
                var StrJsonDatas = eval({
                    DisplayName: $("#txt_" + Result_list[i]["AttachmentID"]).val(),
                });
                var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateFileAttachment", Condition);
            }
        }

    }

    function maildphotos() {
        if (access_level == 3) {
            photogrid = EmpId;
        }
        else {
            photogrid = $('#ddlpht').val();
        }
        var bit = "";
        var ordid = $('#hdnOrderId').val();
        //loader(1);
        var sMailTo = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
        var sMailCC = '@(System.Configuration.ConfigurationManager.AppSettings["defaultmail"].ToString())'
        var sOrdermailoption = 0;
        if ($("#ddlpht").val() != "") {
            var Condition = "Where ref_no=" + $("#hdnPostedBy").val() + "";
            var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sMailCC = Result[0]["email_id"]; //Mail id of client
                sOrdermailoption = Result[0]["mail_option"];
            }

            if (sOrdermailoption == 1) {
                sMailCC = "";
            }
            Condition = "Where ref_no=" + $("#hdnDataentry").val() + "";
            strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
            Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
            if (Result != "" && Result != null) {
                sMailTo = Result[0]["email_id"]; ////Mail id of dataentry
            }
        }
        var photoid = "";
        //$("input[name=addressimage]").each(function () {

        //    photoid += $(this).val() + ",";
        //});

        for (var i = 0; i < unmaildphoto.length; i++) {
            photoid += unmaildphoto[i] + ",";
        }

        //for (var i = 0; i < unmaildphoto_opt.length; i++) {
        //    photoid += unmaildphoto_opt[i] + ",";
        //}

        photoid = photoid.slice(0, -1);

        var sMailBody = CreateMailBody();
        //var sMailBody = "<html><h1>Mail Body for photo upload</h1></html>";

        //if (unmaildphoto_opt.length > 0) {
        //    sMailBody = sMailBody + "</br>" + unmaildphoto_opt.length + " Photos";
        //}
        //peeru start
        var sMailSub = '';
        if (unmaildphoto.length <= 0) {
            if ($('#txtnotefpg').val() != "") {
                sMailSub = 'Notes added/changed by photographer';
            }
            else {
                sMailSub = 'New photo(s) added by photographer of address ';
            }
        }
        else {
            sMailSub = 'New photo(s) added by photographer of address ';
        }
        //end
        var addressname = $('#txtsubaddress').val();
        var sSubAddress = addressname.replace("\t", " ");

        var StrJsonDatas = eval({
            mail_to: sMailTo,
            mail_cc: sMailCC,
            mail_subject: sMailSub + ' : ' + sSubAddress,
            mail_body: sMailBody,
            orderid: ordid,
            attachmentid: photoid
        });

        var Result = oAPICall.Sendmail(StrJsonDatas, 'sendmail');
        if (Result != null || Result != '') {
            //CreateMailLog();
            //alert(Result);

            if ($('#txtnotepg').val() != "") {
                if (sNotesToPht != $('#txtnotepg').val()) {
                    bit = 1;
                    //loader1(1);
                    SendMailOrderUpdation(ordid, "sNotesToPg");
                    //setTimeout(function () {
                    //    rtval = SendMailOrderUpdation(sOrderId, "sNotesToPg");

                    //}, 1000);

                }
            }

            if ($('#ddlorderType').val() != sOrderType) {
                //loader(1);
                bit = 1;
                SendMailOrderUpdation(ordid, "sOrderType");


            }

            if (photogrid != sPhtId) {
                bit = 1;
                SendMailOrderUpdation(ordid, "sPhotoghr");
            }

            if ($("#txtnotede").val() != "") {
                if (sNotesToData != $("#txtnotede").val()) {
                    bit = 1;
                    SendMailOrderUpdation(ordid, "sNotesToDe");
                }
            }
            if ($("#txtnotefde").val() != "") {
                if (sNotesFromData != $("#txtnotefde").val()) {
                    bit = 1; SendMailOrderUpdation(ordid, "sNotesFromData");
                }
            }
            if ($("#ddlstatus").val() != sOrderStatus) {
                if ($("#ddlstatus").val() == 5 || $("#ddlstatus").val() == 6) {
                    bit = 1;
                    SendMailOrderUpdation(ordid, "sOrderStatus");
                }
            }
            setTimeout(function () {
                if (bit == "") {
                    loader(0);
                    msgalert('Success', 'Order ' + document.getElementById("tLblOrderNo").innerHTML + ' Updated successfully. ', 1);//sucess-1, warning-2, error-3
                    parent.$('#framecontent').hide();
                    parent.$('#framecontentlist').show();
                    //window.parent.$('#framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                    if (sIsPageID == undefined)
                        parent.document.getElementById('framecontentlist').src = '../Process/OrderList';
                    else
                        parent.document.getElementById('framecontentlist').src = '../Process/OrderList?PageId=' + sIsPageID + '';
                    parent.$('.modal-backdrop').remove();
                    parent.$("#pagename").text(sPageName);
                    parent.$("#SubModTitle").text(sPageName);
          
                }
            }, 1000);
        }

        //alert("ok");
    }

    function CreateMailBody() {
        var addressname = $('#txtsubaddress').val();
        var sSubAddress = addressname.replace("\t", " ");
        sNotesFromPht = $('#txtnotefpg').val();
        var Condition = "Where ref_no=" + EmpId + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "Selectformcpdmaster");
        if (Result != "" && Result != null) {
            var sPhotogrphername = Result[0]["full_name"];
        }
        var appurl = '@(System.Configuration.ConfigurationManager.AppSettings["appurl"].ToString())'
        var sNewURL = window.location.protocol + "//" + window.location.host + "/" + appurl + "";

        Condition = ' where mail_type=4 '; // mail type 4  Photo Upload
        strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        Result = oAPICall.SelectData(strJsonDatas, "SelectEmailTemplate");

        if (Result != null || Result != '') {
            var sMailData = Result[0].mail_body;

            document.getElementById('MailData').innerHTML = sMailData;
            document.getElementById('dename').innerHTML = "ECESIS Team";
            document.getElementById('jobaddress').innerHTML = sSubAddress;
            document.getElementById('sNotes').innerHTML = sNotesFromPht;
            document.getElementById('photographername').innerHTML = sPhotogrphername;
        }
        if (unmaildphoto_opt_mail.length > 0) {
            document.getElementById('optphotos').innerHTML = "and <b>" + unmaildphoto_opt_mail.length + "</b> optional photos are found please login with your credentials to access these photos (" + sNewURL + ")";
            unmaildphoto_opt_mail = [];
        }
        else {
            document.getElementById('optphotos').innerHTML = "";
        }


        Condition = "where enumeration_key='Order_Type' and value=" + $('#ddlorderType').val();
        strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        Result = oAPICall.SelectData(strJsonDatas, "SelectBtsStatus");
        if (Result != "" && Result != null) {
            document.getElementById('sOrdertype').innerHTML = Result[0]["short_display"];
        }
        else {
            document.getElementById('sOrdertype').innerHTML = "";
        }

        return document.getElementById('MailData').innerHTML;
    }





    //function fileresize(file) {
    //    // Read in file
    //    //var file = event.target.files[0];

    //    // Ensure it's an image
    //    if (file.type.match(/image.*/)) {
    //        console.log('An image has been loaded');

    //        // Load the image
    //        var reader = new FileReader();
    //        reader.onload = function (readerEvent) {
    //            var image = new Image();
    //            image.onload = function (imageEvent) {

    //                // Resize the image
    //                var canvas = document.createElement('canvas'),
    //                    max_size = 544,// TODO : pull max size from a site config
    //                    width = image.width,
    //                    height = image.height;
    //                if (width > height) {
    //                    if (width > max_size) {
    //                        height *= max_size / width;
    //                        width = max_size;
    //                    }
    //                } else {
    //                    if (height > max_size) {
    //                        width *= max_size / height;
    //                        height = max_size;
    //                    }
    //                }
    //                canvas.width = width;
    //                canvas.height = height;
    //                canvas.getContext('2d').drawImage(image, 0, 0, width, height);
    //                var dataUrl = canvas.toDataURL('image/jpeg');
    //                var resizedImage = dataURLToBlob(dataUrl);
    //                //$.event.trigger({
    //                //    type: "imageResized",
    //                //    blob: resizedImage,
    //                //    url: "UploadPhoto"
    //                //});
    //            }
    //            //image.src = readerEvent.target.result;
    //        }
    //        return reader.readAsDataURL(file);
    //    }
    //}

    /* Utility function to convert a canvas to a BLOB */
    var dataURLToBlob = function (dataURL) {
        var BASE64_MARKER = ';base64,';
        if (dataURL.indexOf(BASE64_MARKER) == -1) {
            var parts = dataURL.split(',');
            var contentType = parts[0].split(':')[1];
            var raw = parts[1];

            return new Blob([raw], { type: contentType });
        }

        var parts = dataURL.split(BASE64_MARKER);
        var contentType = parts[0].split(':')[1];
        var raw = window.atob(parts[1]);
        var rawLength = raw.length;

        var uInt8Array = new Uint8Array(rawLength);

        for (var i = 0; i < rawLength; ++i) {
            uInt8Array[i] = raw.charCodeAt(i);
        }

        return new Blob([uInt8Array], { type: contentType });
    }

    /* End Utility function to convert a canvas to a BLOB      */

    /* Handle image resized events */
    $(document).on("imageResized", function (event) {
        var data = new FormData();
        var count = count + 1;
        var ordid = $('#hdnOrderId').val();
        if (event.blob && event.url) {
            data.append("ordid", "" + ordid + "");
            data.append("sessionid", usec);
            data.append("CurrentUser", EmpId);
            data.append("photosec", "man");
            data.append("fileslno", count);
            data.append("counti", 0);
            //data.append("PhotoUpload", file);
            data.append('PhotoUpload', event.blob);

            $.ajax({
                url: event.url,
                data: data,
                cache: false,
                contentType: false,
                processData: false,
                type: 'POST',
                success: function (data) {
                    "";
                }
            });
            return data
        }
    });


    var pgvalue = document.getElementById("imgprogress").clientWidth;
    var pgs = 0;
    var imgdataupload_m = [];
    var imgdataupload_m_name = [];
    var imgdataupload_opt_name = [];
    var arrval = 0;

    function UploadPhoto() {
        imgdataupload_m_name = [];
        arrval = 0;
        var msg = "";
        var totalFiles = document.getElementById("PhotoUpload").files.length;
        var count = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
        if (totalFiles == 0) {
            msgalert('Warning', 'Add alteast one image....', 2);//sucess-1, warning-2, error-3
            return;
        }
        $("#imgprogress").css({ "display": "block" });
        $("#imgdiv").css({ "display": "block" });
        pgs = 100 / totalFiles;
        //imgdataupload_m_name = [];
        for (var i = 0; i < totalFiles; i++) {
            var file = document.getElementById("PhotoUpload").files[i];
            var imgfilename = file.name;
            imgdataupload_m_name.push(imgfilename)
            //(function (file) {

            //});


            if (file.type.match(/image.*/)) {
                //console.log('An image has been loaded');
                var formData = new FormData();


                // Create an image
                //var img = document.createElement("img");

                // Create a file reader
                var reader = new FileReader();
                //var img = document.createElement("IMG");
                // Set the image once loaded into file reader
                reader.onload = function (e) {
                    var img = document.createElement("IMG");
                    var imgdata1 = e.target.result;
                    var resizedImage;
                    img.src = e.target.result;
                    img.onload = function () {
                        var canvas = document.createElement("canvas");
                        var ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);

                        var MAX_WIDTH = 1024;
                        var MAX_HEIGHT = 768;
                        var width = img.width;
                        var height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        var ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0, width, height);

                        var dataurl = canvas.toDataURL("image/jpeg");
                        resizedImage = dataURLToBlob(dataurl);


                        imgdataupload_m.push(resizedImage)

                        var formData = new FormData();
                        var ordid = $('#hdnOrderId').val();
                        formData.append("ordid", "" + ordid + "");
                        formData.append("sessionid", usec);
                        formData.append("CurrentUser", EmpId);
                        formData.append("photosec", "man");
                        formData.append("fileslno", count + arrval);
                        formData.append("counti", arrval + 1);
                        formData.append("filename", imgdataupload_m_name[arrval]);
                        formData.append("PhotoUpload", resizedImage);
                        var countpgs = arrval + 1;
                        $.ajax({
                            xhr: function () {
                                var xhr = new window.XMLHttpRequest();
                                //Upload progress
                                xhr.upload.addEventListener("progress", function (evt) {
                                    if (evt.lengthComputable) {
                                        var percentComplete = evt.loaded / evt.total;
                                        //Do something with upload progress
                                        console.log((percentComplete * 100).toFixed() + '%');
                                        document.getElementById("spnprogressper").innerHTML = (percentComplete * 100).toFixed() + "% Complete" + " (" + countpgs + "/" + totalFiles + ")"
                                        $("#imgprogress").css({ "width": "" + (percentComplete * 100).toFixed() + "%" });

                                    }
                                }, false);
                                //Download progress
                                xhr.addEventListener("progress", function (evt) {
                                    if (evt.lengthComputable) {
                                        var percentComplete = evt.loaded / evt.total;
                                        //Do something with download progress
                                        console.log((percentComplete * 100).toFixed() + '%');
                                        document.getElementById("spnprogressper").innerHTML = (percentComplete * 100).toFixed() + "% Complete" + " (" + countpgs + "/" + totalFiles + ")";
                                        $("#imgprogress").css({ "width": "" + (percentComplete * 100).toFixed() + "%" });

                                    }
                                }, false);
                                return xhr;
                            },
                            url: 'UploadPhoto',
                            data: formData,
                            cache: false,
                            contentType: false,
                            processData: false,
                            type: 'POST',
                            success: function (data) {

                                if (data.Count == totalFiles) {
                                    msgalert('Success', data.Message, 1);//sucess-1, warning-2, error-3
                                    //loadimages(1);
                                    $("#imgprogress").css({ "display": "none" });
                                    $("#imgdiv").css({ "display": "none" });
                                    loadimages(1);
                                }


                                $("#imgprogress").css({ "width": "0" });
                                document.getElementById("spnprogressper").innerHTML = "";
                                $("#PhotoUpload").val("");
                                document.getElementById("imgcount").innerHTML = "";

                                countpgs = countpgs + 1;
                                //$("#imgprogress").css({ "display": "none" });
                                //$("#imgdiv").css({ "display": "none" });
                                loadimages(1);
                            },
                            error: function (data) {
                                alert("File size exceeded")
                            }
                        });

                        arrval = arrval + 1;
                    } // img.onload
                    //sendimages(resizedImage, imgdataupload_m_name[arrval]);


                }
                // Load files into file reader
                reader.readAsDataURL(file);

            }
        }

    }
    function loadddlfilename(ddlname, vaue) {
        $("#" + ddlname).val("" + vaue + "");
        //alert(vaue);
        used = [];
        resetphotoddl_mvalue(ddlname, 1, "");
    }

    var jsonImage = [];
    function loadimageall() {
        jsonImage = [];
        var ordid = $('#hdnOrderId').val();
        //var Condition = "Where Type=" + type + "and OrderID=" + ordid + "";
        var Condition = "Where OrderID=" + ordid + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        jsonImage = oAPICall.SelectData(strJsonDatas, "GetPhotos");
    }

    function jsonloadimages(type) {
        //var Result = jsonImage;
        unmaildphoto_opt_mail = [];

        var r1 = [];
        var r2 = [];
        //padding:10px;
        var html = [];


        if (type == 1) {
            var Result = [];
            var cnt = 0;
            for (i = 0; i < jsonImage.length; i++) {
                var jtype = jsonImage[i]["Type"];
                if (jtype == 1) {
                    Result[cnt] = jsonImage[i];
                    cnt++;
                }
            }

            unmaildphoto = [];
            ddl_m_id = [];
            //var Result = r1;
            if (Result != "" && Result != null) {
                document.getElementById("imageshow").innerHTML = ""
                for (var i = 0; i < Result.length; i++) {
                    if (EmpId == Result[i]["UserID"]) {
                        //if(Result[i]["maild"] == 0)
                        //CurrentUser == Result[i]["UserID"]) {
                        html = [];
                        html.push('<div class="imgcontainer">',
                        '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                        '<img name="photos_m" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                        '<div class="checkboxn_m"><input name="addressimage" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                        if (Result[i]["maild"] == 0) {
                            html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            unmaildphoto.push(Result[i]["AttachmentID"]);
                        }
                        html.push('<select name="photoddl_m" onchange="resetphotoddl_mvalue(this,0,' + Result[i]["AttachmentID"] + ')" style="width:125px" class="select2_demo_3 form-control textphotoimg" id="ddl_' + Result[i]["AttachmentID"] + '" data-placeholder="Choose a Filename...">',

                        '<option value="0">--Select--</option></select>',
                        '</div>');

                        //$('#navigation-bar').append(toAppendModule.join(""));
                        $('#imageshow').append(html.join(""));
                        ddl_m_id.push('ddl_' + Result[i]["AttachmentID"]);

                        //loadfilenames(ordid);

                    }
                    else {
                        if (Result[i]["maild"] != 0) {
                            html = [];
                            html.push('<div class="imgcontainer">',
                            '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                            '<img name="photos_m" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                            '<div class="checkboxn_m"><input name="addressimage" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                            if (Result[i]["maild"] == 0) {
                                html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            }
                            html.push('<select name="photoddl_m" onchange="resetphotoddl_mvalue(this,0,' + Result[i]["AttachmentID"] + ')" style="width:125px" class="select2_demo_3 form-control textphotoimg" id="ddl_' + Result[i]["AttachmentID"] + '" data-placeholder="Choose a Filename...">',
                            '<option value="">--Select--</option></select>',
                            '</div>');

                            //$('#navigation-bar').append(toAppendModule.join(""));
                            $('#imageshow').append(html.join(""));
                            ddl_m_id.push('ddl_' + Result[i]["AttachmentID"]);
                        }
                    }

                    //alert(unmaildphoto.length);
                }

                for (var j = 0; j < filename.length; j++) {

                    $("select[name=photoddl_m]").append('<option value="' + filename[j] + '">' + filename[j] + '</option>');
                    //$("#ddl_303").val("3_Front View");
                }

                for (var h = 0; h < Result.length; h++) {
                    //$("#ddl_303").val("3_Front View");
                    loadddlfilename('ddl_' + Result[h]["AttachmentID"] + '', Result[h]["DisplayName"]);
                }
            }
            else {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow").innerHTML = html;
            }
            if (html == "") {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow").innerHTML = html;
            }
        }

        if (type == 3) {
            var Result = [];
            var cnt = 0;
            for (i = 0; i < jsonImage.length; i++) {
                var jtype = jsonImage[i]["Type"];
                if (jtype == 3) {
                    Result[cnt] = jsonImage[i];
                    cnt++;
                }
            }

            //var Result = r2;
            $("#unupdatealert").addClass('hidden');
            unmaildphoto_opt = [];
            txt_opt_id = [];
            if (Result != "" && Result != null) {
                document.getElementById("imageshow_opt").innerHTML = ""
                for (var i = 0; i < Result.length; i++) {

                    if (EmpId == Result[i]["UserID"]) {
                        var dispname = Result[i]["DisplayName"];
                        html = [];
                        html.push('<div class="imgcontainer">',
                        '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                        '<img name="photos_opt" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                        '<div class="checkboxn_m"><input name="addressimage_opt" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                        if (Result[i]["maild"] == 0) {
                            html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            unmaildphoto_opt.push(Result[i]["AttachmentID"]);
                            unmaildphoto_opt_mail.push(Result[i]["AttachmentID"]);
                        }
                        html.push('<input name="phototxt_o" onChange="savetxtfilename(this,' + Result[i]["AttachmentID"] + ')" alt="' + Result[i]["DisplayName"] + '" type="text" style="width:125px" class="form-control textphotoimg" id="txt_' + Result[i]["AttachmentID"] + '">',
                        '</div>');

                        //$('#navigation-bar').append(toAppendModule.join(""));
                        $('#imageshow_opt').append(html.join(""));
                        var filename_opt = Result[i]["FileName"].split(".");
                        $('#txt_' + Result[i]["AttachmentID"]).val(Result[i]["DisplayName"]);
                        txt_opt_id.push('txt_' + Result[i]["AttachmentID"]);
                        //loadfilenames(ordid);

                    }
                    else {
                        if (Result[i]["maild"] != 0) {
                            html = [];
                            html.push('<div class="imgcontainer">',
                            '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                            '<img name="photos_opt" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                            '<div class="checkboxn_m"><input name="addressimage_opt" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                            if (Result[i]["maild"] == 0) {
                                html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            }
                            html.push('<input name="phototxt_o" onChange="savetxtfilename(this,' + Result[i]["AttachmentID"] + ')" alt="' + Result[i]["DisplayName"] + '" type="text" style="width:125px" class="form-control textphotoimg" id="txt_' + Result[i]["AttachmentID"] + '">',
                            '</div>');

                            //$('#navigation-bar').append(toAppendModule.join(""));
                            $('#imageshow_opt').append(html.join(""));
                            var filename_opt = Result[i]["FileName"].split(".");
                            $('#txt_' + Result[i]["AttachmentID"]).val(Result[i]["DisplayName"]);
                            txt_opt_id.push('txt_' + Result[i]["AttachmentID"]);
                            //loadfilenames(ordid);

                        }
                    }
                }
            }
            else {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow_opt").innerHTML = html;
            }
            if (html == "") {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow_opt").innerHTML = html;
            }


            if (unmaildphoto_opt.length > 0) {
                $("#unupdatealert").removeClass('hidden');
            }
        }
    }
    function loadimages(type) {

        unmaildphoto_opt_mail = [];
        var ordid = $('#hdnOrderId').val();

        var Condition = "Where Type=" + type + "and OrderID=" + ordid + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "GetPhotos");
        //padding:10px;
        var html = [];

        if (type == 1) {
            unmaildphoto = [];
            ddl_m_id = [];
            if (Result != "" && Result != null) {
                document.getElementById("imageshow").innerHTML = ""
                for (var i = 0; i < Result.length; i++) {
                    if (EmpId == Result[i]["UserID"]) {
                        //if(Result[i]["maild"] == 0)
                        //CurrentUser == Result[i]["UserID"]) {
                        html = [];
                        html.push('<div class="imgcontainer">',
                        '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                        '<img name="photos_m" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                        '<div class="checkboxn_m"><input name="addressimage" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                        if (Result[i]["maild"] == 0) {
                            html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            unmaildphoto.push(Result[i]["AttachmentID"]);
                        }
                        html.push('<select name="photoddl_m" onchange="resetphotoddl_mvalue(this,0,' + Result[i]["AttachmentID"] + ')" style="width:125px" class="select2_demo_3 form-control textphotoimg" id="ddl_' + Result[i]["AttachmentID"] + '" data-placeholder="Choose a Filename...">',

                        '<option value="0">--Select--</option></select>',
                        '</div>');

                        //$('#navigation-bar').append(toAppendModule.join(""));
                        $('#imageshow').append(html.join(""));
                        ddl_m_id.push('ddl_' + Result[i]["AttachmentID"]);

                        //loadfilenames(ordid);

                    }
                    else {
                        if (Result[i]["maild"] != 0) {
                            html = [];
                            html.push('<div class="imgcontainer">',
                            '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                            '<img name="photos_m" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                            '<div class="checkboxn_m"><input name="addressimage" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                            if (Result[i]["maild"] == 0) {
                                html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            }
                            html.push('<select name="photoddl_m" onchange="resetphotoddl_mvalue(this,0,' + Result[i]["AttachmentID"] + ')" style="width:125px" class="select2_demo_3 form-control textphotoimg" id="ddl_' + Result[i]["AttachmentID"] + '" data-placeholder="Choose a Filename...">',
                            '<option value="">--Select--</option></select>',
                            '</div>');

                            //$('#navigation-bar').append(toAppendModule.join(""));
                            $('#imageshow').append(html.join(""));
                            ddl_m_id.push('ddl_' + Result[i]["AttachmentID"]);
                        }
                    }

                    //alert(unmaildphoto.length);
                }

                for (var j = 0; j < filename.length; j++) {

                    $("select[name=photoddl_m]").append('<option value="' + filename[j] + '">' + filename[j] + '</option>');
                    //$("#ddl_303").val("3_Front View");
                }

                for (var h = 0; h < Result.length; h++) {
                    //$("#ddl_303").val("3_Front View");
                    loadddlfilename('ddl_' + Result[h]["AttachmentID"] + '', Result[h]["DisplayName"]);
                }
            }
            else {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow").innerHTML = html;
            }
            if (html == "") {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow").innerHTML = html;
            }
        }

        if (type == 3) {
            $("#unupdatealert").addClass('hidden');
            unmaildphoto_opt = [];
            txt_opt_id = [];
            if (Result != "" && Result != null) {
                document.getElementById("imageshow_opt").innerHTML = ""
                for (var i = 0; i < Result.length; i++) {

                    if (EmpId == Result[i]["UserID"]) {
                        var dispname = Result[i]["DisplayName"];
                        html = [];
                        html.push('<div class="imgcontainer">',
                        '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                        '<img name="photos_opt" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                        '<div class="checkboxn_m"><input name="addressimage_opt" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                        if (Result[i]["maild"] == 0) {
                            html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            unmaildphoto_opt.push(Result[i]["AttachmentID"]);
                            unmaildphoto_opt_mail.push(Result[i]["AttachmentID"]);
                        }
                        html.push('<input name="phototxt_o" onChange="savetxtfilename(this,' + Result[i]["AttachmentID"] + ')" alt="' + Result[i]["DisplayName"] + '" type="text" style="width:125px" class="form-control textphotoimg" id="txt_' + Result[i]["AttachmentID"] + '">',
                        '</div>');

                        //$('#navigation-bar').append(toAppendModule.join(""));
                        $('#imageshow_opt').append(html.join(""));
                        var filename_opt = Result[i]["FileName"].split(".");
                        $('#txt_' + Result[i]["AttachmentID"]).val(Result[i]["DisplayName"]);
                        txt_opt_id.push('txt_' + Result[i]["AttachmentID"]);
                        //loadfilenames(ordid);

                    }
                    else {
                        if (Result[i]["maild"] != 0) {
                            html = [];
                            html.push('<div class="imgcontainer">',
                            '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["DisplayName"] + '" data-gallery="">',
                            '<img name="photos_opt" src="../Content/AddressPhotos/AddressPhotos_thm/' + Result[i]["FileName"] + '" style="width:125px;height:125px;  padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>',
                            '<div class="checkboxn_m"><input name="addressimage_opt" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>');
                            if (Result[i]["maild"] == 0) {
                                html.push('<img class="imgtick_m" name="imgtick" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />');
                            }
                            html.push('<input name="phototxt_o" onChange="savetxtfilename(this,' + Result[i]["AttachmentID"] + ')" alt="' + Result[i]["DisplayName"] + '" type="text" style="width:125px" class="form-control textphotoimg" id="txt_' + Result[i]["AttachmentID"] + '">',
                            '</div>');

                            //$('#navigation-bar').append(toAppendModule.join(""));
                            $('#imageshow_opt').append(html.join(""));
                            var filename_opt = Result[i]["FileName"].split(".");
                            $('#txt_' + Result[i]["AttachmentID"]).val(Result[i]["DisplayName"]);
                            txt_opt_id.push('txt_' + Result[i]["AttachmentID"]);
                            //loadfilenames(ordid);

                        }
                    }
                }
            }
            else {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow_opt").innerHTML = html;
            }
            if (html == "") {
                html = html + '<center></br>No Image Found</center>'
                document.getElementById("imageshow_opt").innerHTML = html;
            }


            if (unmaildphoto_opt.length > 0) {
                $("#unupdatealert").removeClass('hidden');
            }
        }
    }

    function savetxtfilename(textbox, attachmentid) {

        //,' + Result[i]["DisplayName"] + '
        var ordid = $('#hdnOrderId').val();
        var ValidationSuccess = false;
        var txtvalue = textbox.value
        var conditiondup = "where OrderID=" + ordid;
        ValidationSuccess = ValidateForDuplicationwithcondition(txtvalue, 'ChkDupfilename', conditiondup);
        if (!ValidationSuccess) {
            msgalert('Error', 'This file name already exist.. Try another', 3);
            $("#" + textbox.id).val(textbox.alt);
            $("#" + textbox.id).focus();
            return false;
        }
        var txtvalue = textbox.value
        var Condition = "Where OrderID=" + ordid + "and AttachmentID=" + attachmentid + "";
        var StrJsonDatas = eval({
            DisplayName: txtvalue
        });
        var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateFileAttachment", Condition);
    }



    function loadfilenames() {
        var ordid = $('#hdnOrderId').val();
        var Condition = "where enumeration_key='photo_File_name'";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectPhotoFileName");
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                //$("select[name=photoddl_m]").append('<option value="' + Result[i]["value"] + '">' + ordid + '_' + Result[i]["short_display"] + '</option>');
                ddl_m_opt_id.push(Result[i]["value"]);
                ddl_m_opt_val.push(ordid + '_' + Result[i]["short_display"]);
                filename.push(Result[i]["short_display"])
            }
        }
    }
    var used = new Array;
    function resetphotoddl_mvalue(ddl, val, attachmentid) {
        //alert($("#ddl_303").val());
        //$('#ddlstate').val();
        $("select[name=photoddl_m] option").each(function () {//For each option
            $(this).show(); //show all options
            $(this).css({ "visibility": "visible" });
            $(this).prop('disabled', false);//hide duplicates
            //$(this).attr('disabled', '');
            //$(this).wrap('<span>').show();
        });



        // Opera 8.0+
        var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

        // Firefox 1.0+
        var isFirefox = typeof InstallTrigger !== 'undefined';

        // Safari 3.0+ "[object HTMLElementConstructor]"
        var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || safari.pushNotification);


        var isIE = !!document.documentMode;
        // Edge 20+
        var isEdge = !isIE && !!window.StyleMedia;

        // Chrome 1+
        var isChrome = !!window.chrome && !!window.chrome.webstore;





        var count = $("select[name=photoddl_m]").length;


        for (var z = 0; z < count; z++) {
            used[z] = $("#" + ddl_m_id[z]).val()//used options
        }
        for (var i = 0; i < count; i++) {

            for (var j = 0; j < used.length; j++) {
                for (var p = 0; p < used.length; p++) {
                    if (j != p) {
                        if ($("#" + ddl_m_id[i]).children('option[value="' + used[p] + '"]').length !== 0) {//check children of selects for duplicate values





                            if (isChrome == true || isFirefox == true) //IF IE > 10
                            {
                                $("#" + ddl_m_id[i]).children('option[value="' + used[p] + '"]').hide();//hide duplicates

                            }
                            else {
                                //$("#ID_DropDown option[value=" + ID_DropDown.options[i].value + "]").prop('disabled', true);
                                //    $("#" + ddl_m_id[i]).append('<option value="0">Select</option>');
                                $("#" + ddl_m_id[i]).children('option[value="' + used[p] + '"]').prop('disabled', true);//hide duplicates

                                $("#" + ddl_m_id[i]).children('option[value="' + used[p] + '"]').css({ "visibility": "hidden" });//hide duplicates
                                // $("#" + ddl_m_id[i]).children('option[value="0"]').prop('disabled', false);//hide duplicates

                                //$("#" + ddl_m_id[i]).children('option[value="' + used[p] + '"]').hide();//hide duplicates .css({"visibility":"hidden"});

                            }

                        }
                    }
                }
            }
        }

        if (val == 0) {

            var ddlvalue = $("option:selected", ddl).text()
            var ordid = $('#hdnOrderId').val();
            var Condition = "Where OrderID=" + ordid + "and AttachmentID=" + attachmentid + "";
            var StrJsonDatas = eval({
                DisplayName: ddlvalue
            });
            var Result = oAPICall.UpdateData(StrJsonDatas, "UpdateFileAttachment", Condition);
        }
        //    alert("OK");
        //}
    }
    function removeimage() {


        var checkbox_value = ""; var chkval = []; var chkvalman = []; chkopt = ""; chkvalopt = [];
        $("input[name=addressimage]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });
        chkvalman = checkbox_value.slice(0, -1).split(",");

        //Take optional photos

        $("input[name=addressimage_opt]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
                chkopt += $(this).val() + ",";
            }
        });
        chkvalopt = chkopt.slice(0, -1).split(",");

        //end

        chkval = checkbox_value.slice(0, -1).split(",")

        if (chkval.length != $("img[name=photos_opt]").length + $("img[name=photos_m]").length) {
            if (chkvalman.length > 3 && $("img[name=photos_opt]").length != 0 && $("img[name=photos_m]").length - chkvalman.length < 3) {
                msgalert('Warning', 'Delete not possible; First remove optional photos ....', 2);
                return;
            }


            if ($("img[name=photos_m]").length <= 3 && $("img[name=photos_opt]").length != 0) {
                msgalert('Warning', 'Delete not possible; First remove optional photos ....', 2);
                return;
            }

            //if (chkvalman.length > 3 && $("img[name=photos_opt]").length - chkvalopt.length != 0 && $("img[name=photos_m]").length - chkvalman.length < 3) {
            //    msgalert('Warning', 'Delete not possible; First remove optional photos ....', 2);
            //    return;
            //}
            //if ($("img[name=photos_m]").length - chkvalman.length == 3 && $("img[name=photos_opt]").length - chkvalopt.length != 0) {
            //    msgalert('Warning', 'Delete not possible; First remove optional photos ....', 2);
            //    return;
            //}


            //if ($("img[name=photos_m]").length - chkvalman.length <= 3) {
            //    msgalert('Warning', 'Delete not possible; First remove optional photos ....', 2);
            //    return;
            //}


            //if(chkvalopt.length==
        }



        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one file....', 2);
            return;
        }

        var re;
        parent.swal({
            title: "Are you sure to delete?",
            //text: "" + text + "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "No",
            closeOnConfirm: true,
            closeOnCancel: true

        },
        function (isConfirm) {
            if (isConfirm) {
                loader(1);
                removeimageconfirm(checkbox_value);
            }
            else {
                return
            }
        });
        return

    }
    function removeimageconfirm(checkbox_value) {
        var strJsonImgData = "";
        var Condition = "where AttachmentID in(" + checkbox_value.slice(0, -1) + ")";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        //var strJsonimgName = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");
        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonImgData = eval({ strCondition: Resultimg[i]["Path"], strFieldNames: null, strSessionID: UserSession })
                var msg2 = JSON.stringify(strJsonImgData);
                var _url = "DeletePhotoDrive";
                $.ajax({
                    async: false,
                    // cache: true,
                    type: "POST", //GET or POST or PUT or DELETE verb
                    url: _url,
                    data: msg2, //Data sent to server
                    contentType: "application/json; charset=utf-8", // content type sent to server
                    dataType: 'json', //Expected data format from server
                    processdata: true, //True or False
                    success: function (data) {
                    },
                    error: function (data) {

                    }
                });

            }
        }
        else { return }
        var Result = oAPICall.DeleteData(strJsonDatas, 'DeletePhotos');


        loadimages(1);
        loadimages(3);
        //update order
        var ordid = $('#hdnOrderId').val();
        var Condition_order = "Where order_no=" + ordid + "";
        var no_photo = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
        var no_phototick = $("img[name=imgtick]").length;
        no_photo = no_photo - no_phototick;
        var sIsPhtUplaod = 0;
        if (no_photo > 0)
            sIsPhtUplaod = 1;
        //var no_files = $("input[name=addressfile]").length;
        var StrJsonDatas_order = eval({
            count_photo_upload: no_photo,
            is_photo_upload: sIsPhtUplaod
            //count_file_upoad: no_files
        });
        var Result_order = oAPICall.UpdateData(StrJsonDatas_order, "UpdateOrder", Condition_order);


        //loadimagesbeforemaild(1);
        //loadimagesbeforemaild(3);
        $("#checkAll").prop("checked", false);
        $("#checkAll_opt").prop("checked", false);
        $("input:checkbox").prop('checked', false);
        setTimeout(function () {
            loader(0);
            msgalert('Success', Result, 1);
        }, 1300);


    }
    function downloadimage_man() {

        //if ($("#chkStamp").is(':checked')) {
        //    alert($("#txtstamdt").val());
        //}

        //return;
        var checkbox_value = "";
        //$(":checkbox").each(function () {
        $("input[name=addressimage]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        //Take optional photos

        $("input[name=addressimage_opt]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        //end

        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one image....', 2);//sucess-1, warning-2, error-3
            return;
        }


        var strJsonImgData = [];
        var Condition = "where AttachmentID in(" + checkbox_value.slice(0, -1) + ")";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");

        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonImgData.push(Resultimg[i]["FileName"])
                strJsonImgData.push(Resultimg[i]["DisplayName"])
            }
            var ordid = $('#hdnOrderId').val();
            strJsonImgData.push(ordid)

            if ($("#chkStamp").is(':checked')) {
                strJsonImgData.push($("#txtstamdt").val())
            }
            else {
                strJsonImgData.push("");
            }
            var sSubjAddrss = $("#txtsubaddress").val();
            var addressname = sSubjAddrss.replace("\t", " ");
            addressname = addressname.replace(/[&\/\\#,+!$~%.'":*?<>{}]/g, ' ');
            strJsonImgData.push(addressname);
        }
        else { return }


        //return 0
        var msg2 = JSON.stringify(strJsonImgData);
        var _url = "DownloadPhoto";
        $.ajax({
            async: false,
            // cache: true,
            type: "POST", //GET or POST or PUT or DELETE verb
            url: _url,
            data: msg2, //Data sent to server
            contentType: "application/json; charset=utf-8", // content type sent to server
            dataType: 'json', //Expected data format from server
            processdata: true, //True or False
            success: function (data) {

            },
            error: function (data) {
                window.location = '../temp/' + data.responseText;
            }
        });

        $("#checkAll").prop("checked", false);
        $("input:checkbox").prop('checked', false);
        //$("#chkStamp").trigger("click");
        $("#stamptext").removeClass('hidden');
        $("#txtStampDate").addClass('hidden');
        $("#chkStamp").prop("checked", false);
    }

    //---------Photo Optional
    function UploadPhoto_opt() {



        imgdataupload_opt_name = [];
        arrval = 0;
        var msg = "";
        var totalFiles = document.getElementById("PhotoUpload_opt").files.length;
        var count = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
        if (totalFiles == 0) {
            msgalert('Warning', 'Add alteast one image....', 2);//sucess-1, warning-2, error-3
            return;
        }
        $("#imgprogress_opt").css({ "display": "block" });
        $("#imgdiv_opt").css({ "display": "block" });
        var pgs = 100 / totalFiles;
        for (var i = 0; i < totalFiles; i++) {
            count = count + 1;
            var file = document.getElementById("PhotoUpload_opt").files[i];
            var imgfilename = file.name;
            imgdataupload_opt_name.push(imgfilename)

            if (file.type.match(/image.*/)) {
                //console.log('An image has been loaded');
                var formData = new FormData();


                // Create an image
                //var img = document.createElement("img");

                // Create a file reader
                var reader = new FileReader();
                //var img = document.createElement("IMG");
                // Set the image once loaded into file reader
                reader.onload = function (e) {
                    var img = document.createElement("IMG");
                    var imgdata1 = e.target.result;
                    var resizedImage;

                    img.src = e.target.result;
                    img.onload = function () {
                        var canvas = document.createElement("canvas");
                        var ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);

                        var MAX_WIDTH = 1024;
                        var MAX_HEIGHT = 768;
                        var width = img.width;
                        var height = img.height;

                        if (width > height) {
                            if (width > MAX_WIDTH) {
                                height *= MAX_WIDTH / width;
                                width = MAX_WIDTH;
                            }
                        } else {
                            if (height > MAX_HEIGHT) {
                                width *= MAX_HEIGHT / height;
                                height = MAX_HEIGHT;
                            }
                        }
                        canvas.width = width;
                        canvas.height = height;
                        var ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0, width, height);
                        dataurl = canvas.toDataURL("image/jpeg");
                        resizedImage = dataURLToBlob(dataurl);


                        var formData = new FormData();
                        var ordid = $('#hdnOrderId').val();
                        formData.append("ordid", "" + ordid + "");
                        formData.append("sessionid", usec);
                        formData.append("CurrentUser", EmpId);
                        formData.append("photosec", "opt");
                        formData.append("fileslno", count + arrval);
                        formData.append("counti", arrval + 1);
                        formData.append("filename", imgdataupload_opt_name[arrval]);
                        formData.append("PhotoUpload", resizedImage);
                        var countpgs = arrval + 1;

                        $.ajax({
                            xhr: function () {
                                var xhr = new window.XMLHttpRequest();
                                //Upload progress
                                xhr.upload.addEventListener("progress", function (evt) {
                                    if (evt.lengthComputable) {
                                        var percentComplete = evt.loaded / evt.total;
                                        //Do something with upload progress
                                        //console.log(percentComplete * 100 + '%');
                                        document.getElementById("spnprogressper_opt").innerHTML = (percentComplete * 100).toFixed() + "% Complete" + " (" + countpgs + "/" + totalFiles + ")"
                                        $("#imgprogress_opt").css({ "width": "" + (percentComplete.toFixed() * 100).toFixed() + "%" });
                                    }
                                }, false);
                                //Download progress
                                xhr.addEventListener("progress", function (evt) {
                                    if (evt.lengthComputable) {
                                        var percentComplete = evt.loaded / evt.total;
                                        //Do something with download progress
                                        //console.log(percentComplete * 100 + '%');
                                        document.getElementById("spnprogressper_opt").innerHTML = (percentComplete * 100).toFixed() + "% Complete" + " (" + countpgs + "/" + totalFiles + ")"
                                        $("#imgprogress_opt").css({ "width": "" + (percentComplete.toFixed() * 100).toFixed() + "%" });
                                    }
                                }, false);
                                return xhr;
                            },
                            type: "POST",
                            //url: 'SaveUploadedFile',
                            url: 'UploadPhoto',
                            data: formData,
                            dataType: 'json',
                            contentType: false,
                            processData: false,
                            success: function (data) {


                                if (data.Count == totalFiles) {
                                    msgalert('Success', data.Message, 1);//sucess-1, warning-2, error-3

                                    loadimages(3);
                                    $("#imgprogress_opt").css({ "display": "none" });
                                    $("#imgdiv_opt").css({ "display": "none" });
                                    loadimages(3);
                                }

                                $("#imgprogress_opt").css({ "width": "0" });
                                document.getElementById("spnprogressper_opt").innerHTML = "";
                                $("#PhotoUpload_opt").val("");
                                document.getElementById("imgcount_opt").innerHTML = "";

                                //$("#imgprogress_opt").css({ "display": "none" });
                                //$("#imgdiv_opt").css({ "display": "none" });
                                countpgs = countpgs + 1;

                                //loadimages(3);

                            },
                            error: function (data) {
                                alert("File size exceeded")
                            }
                        });

                        arrval = arrval + 1;
                    }
                }
                // Load files into file reader
                reader.readAsDataURL(file);
            }
            else {
                msgalert('Error', 'Select only images', 3);//sucess-1, warning-2, error-3
                return;
            }

            //var pgsval = document.getElementById("imgprogress_opt").clientWidth + pgs;

        }

    }
    function removeimage_opt() {

        var checkbox_value = "";
        $("input[name=addressimage_opt]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one file....', 2);
            return;
        }

        var re;
        parent.swal({
            title: "Are you sure to delete?",
            //text: "" + text + "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "No",
            closeOnConfirm: false,
            closeOnCancel: true

        },
        function (isConfirm) {
            if (isConfirm) {
                removeimageconfirm(checkbox_value);
            }
            else {
                return
            }
        });
        return


    }
    function downloadimage_opt() {

        //if ($("#chkStamp").is(':checked')) {
        //    alert($("#txtstamdt").val());
        //}

        //return;
        var checkbox_value = "";
        //$(":checkbox").each(function () {
        $("input[name=addressimage_opt]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one image....', 2);//sucess-1, warning-2, error-3
            return;
        }


        var strJsonImgData = [];
        var Condition = "where AttachmentID in(" + checkbox_value.slice(0, -1) + ")";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");

        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonImgData.push(Resultimg[i]["FileName"])
                strJsonImgData.push(Resultimg[i]["DisplayName"])
            }
            var ordid = $('#hdnOrderId').val();
            strJsonImgData.push(ordid)

            if ($("#chkStamp_opt").is(':checked')) {
                strJsonImgData.push($("#txtstamdt_opt").val())
            }
            else {
                strJsonImgData.push("");
            }

            var addressname = $("#txtsubaddress").val();
            strJsonImgData.push(addressname);

        }
        else { return }


        //return 0
        var msg2 = JSON.stringify(strJsonImgData);
        var _url = "DownloadPhoto";
        $.ajax({
            async: false,
            // cache: true,
            type: "POST", //GET or POST or PUT or DELETE verb
            url: _url,
            data: msg2, //Data sent to server
            contentType: "application/json; charset=utf-8", // content type sent to server
            dataType: 'json', //Expected data format from server
            processdata: true, //True or False
            success: function (data) {

            },
            error: function (data) {
                window.location = '../temp/' + data.responseText;
            }
        });

        $("#checkAll_opt").prop("checked", false);
        $("input:checkbox").prop('checked', false);
        //$("#chkStamp_opt").trigger("click");
        $("#stamptext_opt").removeClass('hidden');
        $("#txtStampDate_opt").addClass('hidden');
        $("#chkStamp_opt").prop("checked", false);
    }

    //-------File upload

    function UploadFile() {
        var msg = "";
        var totalFiles = document.getElementById("FileUpload").files.length;

        if (totalFiles == 0) {
            msgalert('Warning', 'Add alteast one file....', 2);//sucess-1, warning-2, error-3
            return;
        }
        for (var i = 0; i < totalFiles; i++) {
            var file = document.getElementById("FileUpload").files[i];
            var formData = new FormData();
            var ordid = $('#hdnOrderId').val();
            formData.append("ordid", "" + ordid + "");
            formData.append("sessionid", usec);
            formData.append("CurrentUser", EmpId)
            formData.append("FileUpload", file);

            $.ajax({
                type: "POST",
                //url: 'SaveUploadedFile',
                url: 'UploadFile',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {

                    if (i == totalFiles) {
                        msgalert('Success', 'File(s) Uploaded successfully...', 1);//sucess-1, warning-2, error-3
                        i = 0;
                        $("#FileUpload").val("");
                        document.getElementById("filecount").innerHTML = ""
                    }
                    loadfiles();
                    //loadfilesbeforemaild();

                },
                error: function (data) {

                }
            });
        }
    }
    function loadfiles() {
        var ordid = $('#hdnOrderId').val();
        var Condition = "Where Type=2  and OrderID=" + ordid + "";
        //var Condition = "Where Type=2 and maild=1 and OrderID=" + ordid + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "GetPhotos");

        var html = "";
        var src = "";
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                if (EmpId == Result[i]["UserID"]) {
                    var ext = Result[i]["FileName"].split(".")
                    if (Result[i]["FileName"].length > 12) {
                        fname = Result[i]["FileName"].substring(0, 12) + " ..."
                    } else { fname = Result[i]["FileName"] }

                    if (ext[1] == "pdf") {
                        src = "../Content/Image/pdficone.png"
                    }
                    else if (ext[1] == "doc" || ext[1] == "docx") {
                        src = "../Content/Image/wordicone.png"
                    }
                    else if (ext[1] == "xls" || ext[1] == "xlsx") {
                        src = "../Content/Image/excelicon.png"
                    }
                    else if (ext[1] == "ppt" || ext[1] == "pptx") {
                        src = "../Content/Image/powerpointicon.png"
                    }
                    else {
                        src = "../Content/Image/document.png"
                    }
                    html = html + '<div class="imgcontainer">';
                    //html = html + '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["FileName"] + '" data-gallery="">';
                    html = html + '<center><figure>';
                    html = html + '<a  href="' + Result[i]["Path"] + '" target="_blank" title="Click Here to download file"><img class="fieicon" src="' + src + '" style="width:100px;height:100px; padding:10px; padding-bottom:20px"></a>';
                    if (Result[i]["maild"] == 0) {
                        html = html + '<img class="imgtick_m" name="imgtickf" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />';
                    }
                    html = html + '<figcaption style="width:auto" title="' + Result[i]["FileName"] + '">' + fname + '</figcaption>';
                    html = html + '</figure></center> ';
                    //html = html + '<img src="' + Result[i]["Path"] + '" style="width:125px;height:125px; padding:10px; padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>';
                    html = html + '<div class="checkboxn"><input name="addressfile" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>';
                    html = html + '</div>';
                }
                else {
                    if (Result[i]["maild"] != 0) {
                        var ext = Result[i]["FileName"].split(".")
                        if (Result[i]["FileName"].length > 12) {
                            fname = Result[i]["FileName"].substring(0, 12) + " ..."
                        } else { fname = Result[i]["FileName"] }

                        if (ext[1] == "pdf") {
                            src = "../Content/Image/pdficone.png"
                        }
                        else if (ext[1] == "doc" || ext[1] == "docx") {
                            src = "../Content/Image/wordicone.png"
                        }
                        else if (ext[1] == "xls" || ext[1] == "xlsx") {
                            src = "../Content/Image/excelicon.png"
                        }
                        else if (ext[1] == "ppt" || ext[1] == "pptx") {
                            src = "../Content/Image/powerpointicon.png"
                        }
                        else {
                            src = "../Content/Image/document.png"
                        }
                        html = html + '<div class="imgcontainer">';
                        //html = html + '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["FileName"] + '" data-gallery="">';
                        html = html + '<center><figure>';
                        html = html + '<a  href="' + Result[i]["Path"] + '" target="_blank" title="Click Here to download file"><img class="fieicon" src="' + src + '" style="width:100px;height:100px; padding:10px; padding-bottom:20px"></a>';
                        if (Result[i]["maild"] == 0) {
                            html = html + '<img class="imgtick_m" name="imgtickf" src="../Content/Image/checkmark_tick-128.png" style="width:25px; height:25px" />';
                        }
                        html = html + '<figcaption style="width:auto" title="' + Result[i]["FileName"] + '">' + fname + '</figcaption>';
                        html = html + '</figure></center> ';
                        //html = html + '<img src="' + Result[i]["Path"] + '" style="width:125px;height:125px; padding:10px; padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>';
                        html = html + '<div class="checkboxn"><input name="addressfile" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>';
                        html = html + '</div>';
                    }
                }


                document.getElementById("notefile").innerHTML = "<font color='blue'>(Note: Click on file icon to download)</font>";
            }
        }
        else {
            html = html + '<center></br>No File Found</center>'
            document.getElementById("notefile").innerHTML = "";
        }
        document.getElementById("fileshow").innerHTML = html;

        if (html == "") {
            html = html + '<center></br>No File Found</center>'
            document.getElementById("fileshow").innerHTML = html;
            document.getElementById("notefile").innerHTML = "";
        }
    }
    function loadfilesbeforemaild() {
        var ordid = $('#hdnOrderId').val();
        var Condition = "Where Type=2 and OrderID=" + ordid + " and SessionID=" + usec + "";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "GetPhotos");

        var html = "";
        var src = "";
        if (Result != "" && Result != null) {
            for (var i = 0; i < Result.length; i++) {
                var ext = Result[i]["FileName"].split(".")
                if (Result[i]["FileName"].length > 12) {
                    fname = Result[i]["FileName"].substring(0, 12) + " ..."
                } else { fname = Result[i]["FileName"] }

                if (ext[1] == "pdf") {
                    src = "../Content/Image/pdficone.png"
                }
                else if (ext[1] == "doc" || ext[1] == "docx") {
                    src = "../Content/Image/wordicone.png"
                }
                else if (ext[1] == "xls" || ext[1] == "xlsx") {
                    src = "../Content/Image/excelicon.png"
                }
                else if (ext[1] == "ppt" || ext[1] == "pptx") {
                    src = "../Content/Image/powerpointicon.png"
                }
                else {
                    src = "../Content/Image/document.png"
                }
                html = html + '<div class="imgcontainer">';
                //html = html + '<a href="' + Result[i]["Path"] + '" title="' + Result[i]["FileName"] + '" data-gallery="">';
                html = html + '<center><figure>';
                html = html + '<a  href="' + Result[i]["Path"] + '" target="_blank" title="Click Here to download file"><img class="fieicon" src="' + src + '" style="width:100px;height:100px; padding:10px; padding-bottom:20px"></a>';

                html = html + '<figcaption style="width:auto" title="' + Result[i]["FileName"] + '">' + fname + '</figcaption>';
                html = html + '</figure></center> ';
                //html = html + '<img src="' + Result[i]["Path"] + '" style="width:125px;height:125px; padding:10px; padding-bottom:20px" id="' + Result[i]["AttachmentID"] + '"></a>';
                html = html + '<div class="checkboxn"><input name="addressfile" class="imgcheckbox" type="checkbox" value="' + Result[i]["AttachmentID"] + '" > <i></i></div>';
                html = html + '</div>';
            }


            document.getElementById("notefile").innerHTML = "<font color='blue'>(Note: Click on file icon to download)</font>";
        }
        else {
            html = html + '<center></br>No File Found</center>'
            document.getElementById("notefile").innerHTML = "";
        }
        document.getElementById("fileshow").innerHTML = html;
    }
    function removefile() {

        var checkbox_value = "";
        $("input[name=addressfile]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one file....', 2);
            return;
        }

        var re;
        parent.swal({
            title: "Are you sure to delete?",
            //text: "" + text + "",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "No",
            closeOnConfirm: true,
            closeOnCancel: true

        },
        function (isConfirm) {
            if (isConfirm) {
                removefileconfirm(checkbox_value);
            }
            else {
                return
            }
        });
        return

    }
    function removefileconfirm(checkbox_value) {

        var strJsonImgData = "";
        var Condition = "where AttachmentID in(" + checkbox_value.slice(0, -1) + ")";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        //var strJsonimgName = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");
        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonImgData = eval({ strCondition: Resultimg[i]["Path"], strFieldNames: null, strSessionID: UserSession })
                var msg2 = JSON.stringify(strJsonImgData);
                var _url = "DeleteFileDrive";
                $.ajax({
                    async: false,
                    // cache: true,
                    type: "POST", //GET or POST or PUT or DELETE verb
                    url: _url,
                    data: msg2, //Data sent to server
                    contentType: "application/json; charset=utf-8", // content type sent to server
                    dataType: 'json', //Expected data format from server
                    processdata: true, //True or False
                    success: function (data) {
                    },
                    error: function (data) {

                    }
                });

            }
        }
        else { return }
        var Result = oAPICall.DeleteData(strJsonDatas, 'DeletePhotos');
        loadfiles();

        var ordid = $('#hdnOrderId').val();
        var Condition_order = "Where order_no=" + ordid + "";
        //var no_photo = $("img[name=photos_opt]").length + $("img[name=photos_m]").length;
        //var no_phototick = $("img[name=imgtick]").length;
        //no_photo = no_photo - no_phototick;
        var no_files = $("input[name=addressfile]").length;
        var no_filetick = $("img[name=imgtickf]").length;
        no_files = no_files - no_filetick;
        var StrJsonDatas_order = eval({
            //count_photo_upload: no_photo,
            count_file_upoad: no_files
        });
        var Result_order = oAPICall.UpdateData(StrJsonDatas_order, "UpdateOrder", Condition_order);

        $("#checkAll").prop("checked", false);
        $("input:checkbox").prop('checked', false);
        msgalert('Success', Result, 1);

    }

    function removefilenotmaild() {
        var strJsonImgData = "";
        var cudate = new Date();
        var strJsonDatas = "";
        cudate.setDate(cudate.getDate() - 2);
        cudate = FormatCurrentDate("yyyy-mm-dd", cudate);
        var Condition = "where maild=0 and UserID='" + EmpId + "' and SessionID='" + usec + "'or doc='" + cudate + "' and maild=0";
        //var Condition = "where maild=0 or doc='" + cudate + "'";
        strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        //var strJsonimgName = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });

        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");
        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonImgData = eval({ strCondition: Resultimg[i]["Path"], strFieldNames: null, strSessionID: UserSession })
                var msg2 = JSON.stringify(strJsonImgData);
                var _url = "DeletePhotoDrive";
                $.ajax({
                    async: false,
                    // cache: true,
                    type: "POST", //GET or POST or PUT or DELETE verb
                    url: _url,
                    data: msg2, //Data sent to server
                    contentType: "application/json; charset=utf-8", // content type sent to server
                    dataType: 'json', //Expected data format from server
                    processdata: true, //True or False
                    success: function (data) {
                    },
                    error: function (data) {

                    }
                });

            }
        }
        else { return }
        var Result = oAPICall.DeleteData(strJsonDatas, 'DeletePhotos');
    }
    function downloadimage_file() {

        //if ($("#chkStamp").is(':checked')) {
        //    alert($("#txtstamdt").val());
        //}

        //return;
        var checkbox_value = "";
        //$(":checkbox").each(function () {
        $("input[name=addressfile]:checked").each(function () {
            var ischecked = $(this).is(":checked");
            if (ischecked) {
                checkbox_value += $(this).val() + ",";
            }
        });

        if (checkbox_value == "") {
            msgalert('Warning', 'Select alteast one image....', 2);//sucess-1, warning-2, error-3
            return;
        }


        var strJsonfileData = [];
        var Condition = "where AttachmentID in(" + checkbox_value.slice(0, -1) + ")";
        var strJsonDatas = eval({ strCondition: Condition, strFieldNames: null, strSessionID: UserSession });
        var Resultimg = oAPICall.SelectData(strJsonDatas, "GetPhotos");

        if (Resultimg != "" && Resultimg != null) {
            for (var i = 0; i < Resultimg.length; i++) {
                strJsonfileData.push(Resultimg[i]["FileName"])
            }
            var ordid = $('#hdnOrderId').val();
            strJsonfileData.push(ordid)

            var addressname = $("#txtsubaddress").val();
            strJsonfileData.push(addressname + "_file(s)");
        }
        else { return }


        //return 0
        var msg2 = JSON.stringify(strJsonfileData);
        var _url = "DownloadFile";
        $.ajax({
            async: false,
            // cache: true,
            type: "POST", //GET or POST or PUT or DELETE verb
            url: _url,
            data: msg2, //Data sent to server
            contentType: "application/json; charset=utf-8", // content type sent to server
            dataType: 'json', //Expected data format from server
            processdata: true, //True or False
            success: function (data) {

            },
            error: function (data) {
                window.location = '../temp/' + data.responseText;
            }
        });

        $("#checkAll").prop("checked", false);
        $("input:checkbox").prop('checked', false);
        //$("#chkStamp").trigger("click");
        $("#stamptext").removeClass('hidden');
        $("#txtStampDate").addClass('hidden');
        $("#chkStamp").prop("checked", false);
    }



    function settabid(tab) {
        var orderid = $('#hdnOrderId').val();
        if ($("#txtsubaddress").val() == "") {


        }
        tabid = tab.id;

    }



    function PopulateOrderData(sOrderId, frmist) {

        var sCondition = " WHERE delete_status=0 and order_no=" + sOrderId + "";
        var strJsonDatas = eval({ strCondition: sCondition, strFieldNames: null, strSessionID: UserSession });
        var Result = oAPICall.SelectData(strJsonDatas, "SelectOrderDet");
        if (Result != '' && Result != null) {
            $("#divOrderdet").removeClass("hidden")
            $("#txtorderno").val(Result[0].order_no);
            var sOrderPortalNo = Result[0].order_portal_no;
            if (sOrderPortalNo == undefined || sOrderPortalNo == "")
                sOrderPortalNo="";

            document.getElementById("tLblOrderNo").innerHTML = sOrderPortalNo;
            //  document.getElementById("tLblOrderNo").innerHTML = Result[0].order_code;
            document.getElementById("tLblOrderAddress").innerHTML = Result[0].subject_address;



            BindSubClientwithorder(Result[0].subclient_id, Result[0].order_posted_by)
            $("#ddlSubClient").val(Result[0].subclient_id).change();
            //if (suborgin == Result[0].subclient_id) {

            //        $('#divDdlClient').addClass("hide");
            //}

            $("#txtsubaddress").val(Result[0].subject_address);
            $("#ddlstate").val(Result[0].state_id).change();
            $("#ddlcity").val(Result[0].city_id).change();
            $("#txtzipcode").val(Result[0].zip_code);
            $('#txtorderportalno').val(Result[0].order_portal_no),
            $("#ddlportal").val(Result[0].portal_id).change();
            var dt = Result[0].order_due_date;
            var res = dt.replace("T", " ");
            d = new Date(res);

            var date = d.format("mm/dd/yyyy");

            if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) //IF IE > 10
            {
                var time = FormatTimeAMPM(dt);
            }
            else {
                var time = FormatTimeAMPM(res);
            }



            // $("#txtdob").val(date);
            $("#txtdob").datepicker("setDate", date);

            $("#txtdobtime").val(time);
            sOrderType = Result[0].order_type;

            $("#ddlorderType").val(sOrderType).change();
            $("#txtremarks").val(Result[0].remarks);
            sNotesToPht = Result[0].notes_for_pht;
            $("#txtnotepg").val(sNotesToPht);
            sNotesToData = Result[0].notes_for_dataentry;
            $("#txtnotede").val(sNotesToData);
            $("#txtnoteqa").val(Result[0].notes_for_qa);
            sNotesFromPht = Result[0].notes_from_pht;
            $("#txtnotefpg").val(sNotesFromPht);
            sNotesFromData = Result[0].notes_from_dataentry
            $("#txtnotefde").val(sNotesFromData);
            $("#txtnotefqa").val(Result[0].notes_from_qa);

            sOrderStatus = Result[0].order_status

            $("#ddlstatus").val(sOrderStatus).change();

            var dtp = Result[0].photo_due_date;
            var resp = dtp.replace("T", " ");
            dp = new Date(resp);

            var datep = dp.format("mm/dd/yyyy");
            //var timep = FormatTimeAMPM(resp);

            if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) //IF IE > 10
            {
                var timep = FormatTimeAMPM(dtp);
            }
            else {
                var timep = FormatTimeAMPM(resp);
            }



            sPhtId = Result[0].photographer_id;
            sgExistPhtId = sPhtId;
            //$("#txtphtduedate").val(datep);
            $("#txtphtduedate").datepicker("setDate", datep);
            $("#txtphtoduetime").val(timep);
            $("#ddlpht").val(sPhtId).change();
            $("#txtphtfee").val(Result[0].photo_fee);
            $("#ddldataentry").val(Result[0].dataentry_id).change();
            $("#txtdefee").val(Result[0].data_fee);
            $("#ddlqa").val(Result[0].qa_id).change();
            $("#txtqafee").val(Result[0].qa_fee);
            $("#txtordervalue").val(Result[0].order_value);

            $("#hdnPostedBy").val(Result[0].order_posted_by);
            $("#hdnDataentry").val(Result[0].dataentry_id);
            sIsDataEntryComp = Result[0].is_entry_comp;
            sIsPaid = Result[0].is_paid;
            //hideload();
            if (frmist == 1) {
                loader(0);
            }
            DisableTextbox();
            sIsPhotoUpld = Result[0].count_photo_upload;
            sIsPhotoExist = Result[0].is_photo_upload;
            if (sIsPhotoUpld != 0) {
                $("#ddlpht").prop("disabled", true);
            }
            //alert(access_level + ", ," + EmpId);

        }
    }

    function DisableTextbox() {

        if (access_level >= 3) {
            $("#txtnotepg").focus();
            $("#ddlpht").prop("disabled", true);
            $("#divOrderdet").prop("disabled", true);
            $("#txtorderno").prop("disabled", true);

            $("#txtsubaddress").prop("disabled", true);
            $("#ddlstate").prop("disabled", true);
            $("#ddlcity").prop("disabled", true);
            $("#txtzipcode").prop("disabled", true);
            $("#txtorderportalno").prop("disabled", true);
            $("#txtdob").prop("disabled", true);


            $("#divtxtdob").addClass("hide");
            $("#divtxtphtduedate").addClass("hide");
            $("#btnNew").addClass("hide");

            $("#txtdobtime").prop("disabled", true);
            $("#ddlorderType").prop("disabled", true);
            $("#txtremarks").prop("disabled", true);
            $("#txtnotede").prop("disabled", true);
            $("#txtnoteqa").prop("disabled", true);
            $("#txtphtfee").prop("disabled", true);
            $("#txtdefee").prop("disabled", true);
            $("#txtqafee").prop("disabled", true);

            $("#ddlportal").prop("disabled", true);
            $("#ddlSubClient").prop("disabled", true);

            $("#ddlstatus").prop("disabled", true);
            $("#txtphtduedate").prop("disabled", true);
            $("#txtphtoduetime").prop("disabled", true);
            $("#ddlpht").prop("disabled", true);

        }
        if (access_level != 3) {
            $("select[name=photoddl_m]").prop("disabled", true);
            $("input[name=phototxt_o]").prop("disabled", true);
            $("#ddlstatus").prop("disabled", false);
        }
        if (access_level == 4) {
            $("#txtnotede").prop("disabled", false);
            $("#txtnotepg").prop("disabled", true);
        }

        if (access_level == 2) {
            $('#divpht').removeClass("hidden");
            $('#divde').removeClass("hidden");
            $('#txtnotefpg').prop("disabled", true);
            $('#txtnotefde').prop("disabled", true);
            $('#txtnotefqa').prop("disabled", true);
        }


        if (access_level == 3) {

            $('#divpht').removeClass("hidden");
            $("#txtnotefpg").focus();
            $('#txtnotepg').prop("disabled", true);

            //$('#txtnotefde').prop("disabled", true);
            //$('#txtnotefqa').prop("disabled", true);
        }

        if (access_level == 4) {
            $('#divde').removeClass("hidden");
            $('#divpht').removeClass("hidden");
            $('#txtnotede').prop("disabled", true);
            $('#txtnotefpg').prop("disabled", true);
            $("#txtnotefde").focus();
            if ($("#ddlstatus").val() == 3) {
                $('#ddlstatus').prop("disabled", true);
            }
            $("#ddlstatus option[value=3]").remove();

        }

        if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) //IF IE > 10
        {
            if ($('#hdnOrderId').val() != "") {
                if (access_level == 1) {

                    $("#ddlSubClient").prop("disabled", false);
                    $("#ddlstate").prop("disabled", false);
                    $("#ddlcity").prop("disabled", false);
                    $("#ddlorderType").prop("disabled", false);
                }
                if (access_level == 2) {

                    $("#ddlSubClient").prop("disabled", false);
                    $("#ddlstate").prop("disabled", false);
                    $("#ddlcity").prop("disabled", false);
                    $("#ddlorderType").prop("disabled", false);
                    $("#ddlportal").prop("disabled", false);
                    $("#ddlpht").prop("disabled", false);
                }
            }
        }
    }

    var listflag = GetQueryStringParams("flag");// Used to identify this page is call from list



    //------------Event Functions----------
    $(function () {
        window.onbeforeunload = function (e) {

            if (unmaildphoto.length != 0) {
                parent.$("#myModalLoadmenu").modal("hide");
                return "Unupdated photos are found in this order..! Are you sure you want to leave?"
            }
        }

        $('#ddlstate').change(function () {
            BindCity();
        });
        $("#chkStamp").click(function () {
            $("#txtStampDate").toggleClass("hidden")
            $("#stamptext").toggleClass("hidden")
            //alert("ok");stamptext
        });
        $("#chkStamp_opt").click(function () {
            $("#txtStampDate_opt").toggleClass("hidden")
            $("#stamptext_opt").toggleClass("hidden")
            //alert("ok");stamptext
        });





        $("#PhotoUpload").change(function () {

            //alert($("img[name=photos_m]").length);

            if ($("img[name=photos_m]").length < 7) {
                var totalFiles = document.getElementById("PhotoUpload").files.length;
                if (totalFiles <= 7) {
                    if (($("img[name=photos_m]").length) + totalFiles <= 7) {
                        document.getElementById("imgcount").innerHTML = "(" + totalFiles + ")";
                    }
                    else {
                        msgalert('Error', 'Remaining ' + (7 - $("img[name=photos_m]").length) + ' photos are allowed for Mandatory', 3);
                        document.getElementById("PhotoUpload").value = "";
                    }

                }
                else {
                    if ($("img[name=photos_m]").length == 0) {
                        msgalert('Error', 'Maximum 7 photos are allowed for Mandatory', 3);//sucess-1, warning-2, error-3
                        document.getElementById("PhotoUpload").value = "";
                    }
                    else {
                        msgalert('Error', 'Remaining ' + (7 - $("img[name=photos_m]").length) + ' photos are allowed for Mandatory', 3);
                        document.getElementById("PhotoUpload").value = "";
                    }
                }
            }
            else {
                msgalert('Error', 'Maximum 7 photos are allowed for Mandatory', 3);//sucess-1, warning-2, error-3
                document.getElementById("PhotoUpload").value = "";
            }

        });

        $("#PhotoUpload_opt").change(function () {

            //alert($("img[name=photos_m]").length);

            var totalFiles = document.getElementById("PhotoUpload_opt").files.length;

            //if (totalFiles > 20) {
            //    msgalert('Error', 'Maximum 20 photos are allowed at a time', 3);
            //    document.getElementById("PhotoUpload_opt").value = "";
            //    return;
            //}

            if ($("img[name=photos_opt]").length < 100) {
                //if (totalFiles <= 20) {
                if (($("img[name=photos_opt]").length) + totalFiles <= 100) {
                    document.getElementById("imgcount_opt").innerHTML = "(" + totalFiles + ")";
                }
                else {
                    msgalert('Error', 'Remaining ' + (100 - $("img[name=photos_opt]").length) + ' photos are allowed for optional', 3);
                    document.getElementById("PhotoUpload_opt").value = "";
                }

                //}
            }
            else {
                msgalert('Error', 'Maximum 100 photos are allowed for optional', 3);//sucess-1, warning-2, error-3
                document.getElementById("PhotoUpload_opt").value = "";
            }

        });


        $("#FileUpload").change(function () {
            var totalFiles = document.getElementById("FileUpload").files.length;
            document.getElementById("filecount").innerHTML = "(" + totalFiles + ")";
        });


        $("#PhotoUpload_opt").click(function (e) {
            if ($("img[name=photos_m]").length < 3) {
                e.preventDefault();
                msgalert('Error', 'Minimum 3 photos are required for mandatory..', 3);//sucess-1, warning-2, error-3
                return false;
            }
        });

        $("#PhotoUpload").click(function (e) {

            if ($('#hdnOrderId').val() == "") {
                e.preventDefault();
                msgalert('Error', 'No order found..', 3);//sucess-1, warning-2, error-3
                return false;
            }

        });

        $("#FileUpload").click(function (e) {
            if ($('#hdnOrderId').val() == "") {
                e.preventDefault();
                msgalert('Error', 'No order found..', 3);//sucess-1, warning-2, error-3
                return false;
            }
        });

        $("#2_fee").click(function (e) {
            if (access_level == 3) {
                $('#Rol_DataEntryQA').hide();
            }
            else {
                $('#Rol_DataEntryQA').show();
            }

            if (access_level != 2) {
                $('#divOrdervalue').hide();
            }

            if ($('#txtsubaddress').val() == "") {
                e.preventDefault();
                //document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter address and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtsubaddress').focus();
                return false;
            }
            if ($('#txtzipcode').val() == "") {
                e.preventDefault();
                //document.getElementById('txtzipcode').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter zipcode and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtzipcode').focus();
                return false;
            }
            if ($('#txtorderportalno').val() == "") {
                e.preventDefault();
                //document.getElementById('txtorderportalno').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter order no. and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtorderportalno').focus();
                return false;
            }
            if ($('#ddlorderType').val() == "") {
                e.preventDefault();
                //document.getElementById('ddlorderType').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please select order type and continue..!', 3);//sucess-1, warning-2, error-3
                $('#ddlorderType').focus();
                return false;
            }

        });

        $("#3_Photo").click(function (e) {
            if (access_level == 5) {
                $('.btnPhotoUp').hide();
                $('#Upload1').hide();
                $('#Upload1_opt').hide();
                $('.btndeleteimg').hide();

            }
            else {
                $('.btnPhotoUp').show();
                $('.btndeleteimg').show();
                $('#Upload1').show();
                $('#Upload1_opt').show();
            }
            if ($('#txtsubaddress').val() == "") {
                e.preventDefault();
                //document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter address and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtsubaddress').focus();
                return false;
            }
            if ($('#txtzipcode').val() == "") {
                e.preventDefault();
                //document.getElementById('txtzipcode').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter zipcode and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtzipcode').focus();
                return false;
            }
            if ($('#ddlorderType').val() == "") {
                e.preventDefault();
                //document.getElementById('ddlorderType').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please select order type and continue..!', 3);//sucess-1, warning-2, error-3
                $('#ddlorderType').focus();
                return false;
            }
        });

        $("#4_file").click(function (e) {
            if ($('#txtsubaddress').val() == "") {
                e.preventDefault();
                //document.getElementById('txtsubaddress').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter address and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtsubaddress').focus();
                return false;
            }
            if ($('#txtzipcode').val() == "") {
                e.preventDefault();
                //document.getElementById('txtzipcode').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please enter zipcode and continue..!', 3);//sucess-1, warning-2, error-3
                $('#txtzipcode').focus();
                return false;
            }
            if ($('#ddlorderType').val() == "") {
                e.preventDefault();
                //document.getElementById('ddlorderType').style.borderColor = "red";// this adds the error class
                msgalert('Error', 'Please select order type and continue..!', 3);//sucess-1, warning-2, error-3
                $('#ddlorderType').focus();
                return false;
            }
        });

        $("#checkAll").change(function () {
            //$("input:checkbox").prop('checked', $(this).prop("checked"));
            $("input[name=addressimage]").prop('checked', $(this).prop("checked"));
            $("input[name=addressimage_opt]").prop('checked', $(this).prop("checked"));
        });
        $("#checkAll_opt").change(function () {
            //$("input:checkbox").prop('checked', $(this).prop("checked"));
            $("input[name=addressimage_opt]").prop('checked', $(this).prop("checked"));
        });
        $("#checkAllFile").change(function () {
            //$("input:checkbox").prop('checked', $(this).prop("checked"));
            $("input[name=addressfile]").prop('checked', $(this).prop("checked"));
        });
    });
    //-------------END------------

    function CallGetOrder(sOrderNo, sPageId, sPgName) {
        sIsPageID = sPageId;
        sPageName = sPgName;
        $('#hdnOrderId').val(sOrderNo);
        loadimageall();
        jsonloadimages(1);
        jsonloadimages(3);
        loadfiles();
        PopulateOrderData(sOrderNo, 1);
        $("#1_gen").trigger("click");
    }
    $(document).ready(function () {

        //---------when page open from list popup.....
        if (listflag == 1) {
            $('[name="listcheck"]').addClass("hide");
        }
        //---------END.....



        $('#hdnOrderId').val(GetQueryStringParams("orderid"));


        if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) //IF IE > 10
        {
            if ($('#hdnOrderId').val() != "") {
                $("#ddlSubClient").prop("disabled", true);
                $("#ddlstate").prop("disabled", true);
                $("#ddlcity").prop("disabled", true);
                $("#ddlorderType").prop("disabled", true);
                $("#ddlportal").prop("disabled", true);
                $("#ddlpht").prop("disabled", true);
            }
        }



        $("#ddlstatus").prop("disabled", true);

        if ($('#hdnOrderId').val() != "") {
            parent.$("#pagename").text("Edit Order");
            parent.$("#ModuleTitle").text("Dashboard");
            parent.$("#SubModTitle").text("Edit Order");
            loader(1);
            //$("#ddlstatus").prop("disabled", false);
            //show();
        }

        $("#imgdiv").css({ "display": "none" });
        $("#imgdiv_opt").css({ "display": "none" });

       
        //BindOrderType();//enum
        //loadfilenames();//enum
        //BindOrderStatus();//enum
        Bindenumkey();
        BindState();
        BindDataentry();

        //$("#ddlpht").val(1).change();

        document.getElementById("ddlqa").selectedIndex = 1;
        $('#ddlqa').trigger("change");
        document.getElementById("ddldataentry").selectedIndex = 1;
        $('#ddldataentry').trigger("change");

        usec = parent.uResult[0]["sessionid"];



        setTimeout(function () {
          
            //removefilenotmaild();
            BindPortal();
            BindPhotographer();
            //BindClientFee();

            //document.getElementById("ddlpht").selectedIndex = 1;
            //$('#ddlpht').trigger("change");

            var sOrderId = $('#hdnOrderId').val();
            if (sOrderId != 0 && sOrderId != "") {
                loadimageall();
                jsonloadimages(1);
                jsonloadimages(3);
                loadfiles();
                PopulateOrderData(sOrderId, 1);
            }
            else {
                BindSubClient();
            }

            //var qOrderIs = GetQueryStringParams("qOrderIs")
            //if (qOrderIs > 0) {
            //    PopulateOrderData(qOrderIs, 1)
            //}

            if (access_level == 2 || access_level == 1) {
                $('#divpht').removeClass("hidden");
                $('#divde').removeClass("hidden");
                $('#txtnotefpg').prop("disabled", true);
                $('#txtnotefde').prop("disabled", true);
                $('#txtnotefqa').prop("disabled", true);
            }

        }, 1300);

        $('#txtStampDate .input-group.date').datepicker({
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: false,
            autoclose: true,
            format: "mm/dd/yyyy",
            todayHighlight: true
        });
        $("#txtStampDate .input-group.date").datepicker("setDate", new Date());

        $('#txtStampDate_opt .input-group.date').datepicker({
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: false,
            autoclose: true,
            format: "mm/dd/yyyy",
            todayHighlight: true
        });
        $("#txtStampDate_opt .input-group.date").datepicker("setDate", new Date());

        var tempStartDate = new Date();
        var default_end = new Date(tempStartDate.getFullYear(), tempStartDate.getMonth(), tempStartDate.getDate() + 3);
        var sStartDate = new Date(tempStartDate.getFullYear(), tempStartDate.getMonth(), tempStartDate.getDate() - 2);
        $('.input-group.date.txtdob').datepicker({
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: false,
            autoclose: true,
            format: "mm/dd/yyyy",
            todayHighlight: false,
            //startDate: '-2m',
            startDate: sStartDate
        });

        $(".input-group.date.txtdob").datepicker("setDate", default_end);



        $('.input-group.date.txtphtduedate').datepicker({
            todayBtn: "linked",
            keyboardNavigation: false,
            forceParse: false,
            calendarWeeks: false,
            autoclose: true,
            format: "mm/dd/yyyy",
            todayHighlight: false,
            //startDate: '-2m',
            startDate: sStartDate,
            endDate: $('#txtdob').val()
        });
        $(".input-group.date.txtphtduedate").datepicker("setDate", $('#txtdob').val());



        $(".datetime").datetimepicker(
            {
                format: 'LT'
            });
        $('.time').timeEntry({ ampmPrefix: ' ' });
        $('.time').timeEntry('setTime', '12.00 AM')




    });



</script>
